{"id": "0", "text": "# Claude Code Instructions\n\n## Python Environment\n\nUse `uv` for all Python package management and execution:\n\n```bash\n# Install dependencies\nuv sync\n\n# Add new packages\nuv add <package-name>\n\n# Run the server\nuv run braindump\n\n# Run any Python command\nuv run python <script.py>\n```\n\nDo not use pip, venv, or virtualenv directly.\n\n## Project Status\n\nAlways update `PROJECT-STATUS.md` after completing major items or phases of work. Keep it current with completed features, remaining work, and any implementation details.", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/CLAUDE.md", "file_name": "CLAUDE.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "1", "text": "# Braindump Project Status\n\n## Completed\n\n- [x] **Phase 1: Basic Capture** - Flask backend, git storage, document CRUD, auto-save editor, recent documents list\n- [x] **Phase 2: Index & TODOs** - SQLite index, TODO/TASK extraction, DONE detection, Master TODO modal with click-to-source\n- [x] **Phase 3: Semantic Search** - sentence-transformers embeddings, cosine similarity search, search dropdown UI with Cmd+K\n- [x] **Phase 4: Consolidation** - LLM integration (OpenRouter/Anthropic), consolidation API, side-by-side diff view, accept/reject flow\n\n## Remaining\n\n- [ ] **Phase 5: Morning Summary** - Activity queries, open TODOs, suggested next action, landing page view\n- [ ] **Phase 6: Polish** - PWA manifest/service worker, multi-device sync polling, UI refinements, [QUESTION:] aggregation\n\n## Tech Stack", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/PROJECT-STATUS.md", "file_name": "PROJECT-STATUS.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "2", "text": "## Remaining\n\n- [ ] **Phase 5: Morning Summary** - Activity queries, open TODOs, suggested next action, landing page view\n- [ ] **Phase 6: Polish** - PWA manifest/service worker, multi-device sync polling, UI refinements, [QUESTION:] aggregation\n\n## Tech Stack\n\n- **Backend:** Python/Flask, SQLite, gitpython, sentence-transformers, httpx\n- **Frontend:** Vanilla JS, CodeMirror, CSS (dark theme)\n- **Storage:** Git repo (canonical), SQLite (derived index)\n- **LLM:** OpenRouter API (configurable, Anthropic support built-in)\n- **Package Management:** uv (see `pyproject.toml`)\n\n## Phase 4 Implementation Details\n\n### New Files Created\n- `server/llm.py` - LLM provider abstraction (OpenRouter, Anthropic)\n- `server/consolidation.py` - Consolidation logic and prompts\n- `web/js/consolidation.js` - Frontend consolidation modal and diff viewer", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/PROJECT-STATUS.md", "file_name": "PROJECT-STATUS.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "3", "text": "## Phase 4 Implementation Details\n\n### New Files Created\n- `server/llm.py` - LLM provider abstraction (OpenRouter, Anthropic)\n- `server/consolidation.py` - Consolidation logic and prompts\n- `web/js/consolidation.js` - Frontend consolidation modal and diff viewer\n\n### API Endpoints Added\n- `POST /api/consolidate` - Start consolidation for document(s)\n- `GET /api/consolidate/proposals` - List active proposals\n- `GET /api/consolidate/proposals/<branch>` - Get proposal details\n- `POST /api/consolidate/proposals/<branch>/accept` - Accept changes\n- `POST /api/consolidate/proposals/<branch>/reject` - Discard proposal", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/PROJECT-STATUS.md", "file_name": "PROJECT-STATUS.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "4", "text": "### API Endpoints Added\n- `POST /api/consolidate` - Start consolidation for document(s)\n- `GET /api/consolidate/proposals` - List active proposals\n- `GET /api/consolidate/proposals/<branch>` - Get proposal details\n- `POST /api/consolidate/proposals/<branch>/accept` - Accept changes\n- `POST /api/consolidate/proposals/<branch>/reject` - Discard proposal\n\n### Configuration\nUpdate `config.json` with your OpenRouter API key:\n```json\n{\n  \"llm\": {\n    \"provider\": \"openrouter\",\n    \"model\": \"anthropic/claude-3.5-sonnet\",\n    \"api_key\": \"${OPENROUTER_API_KEY}\"\n  }\n}\n```\nOr set the environment variable: `export OPENROUTER_API_KEY=your_key_here`", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/PROJECT-STATUS.md", "file_name": "PROJECT-STATUS.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "5", "text": "# Braindump: Personal Knowledge Base System\n\n## Specification Document v1.0\n\n---\n\n## Executive Summary\n\nBraindump is a low-friction personal knowledge capture system with intelligent background consolidation. The core philosophy is that the moment of capture and the moment of organization are fundamentally different cognitive modes—forcing them together creates friction that kills the habit.\n\nThe system has three functional layers:\n\n1. **Capture** — instant, unstructured, zero ceremony\n2. **Consolidation** — AI-driven process that cleans, merges, and organizes\n3. **Retrieval & Guidance** — semantic search plus proactive task intelligence\n\n---\n\n## Design Principles\n\n### Zero Friction Capture\nThe system must feel as fast as opening a new Notepad++ tab. No formatting required. No decisions about where to file. Just start typing.\n\n### Recency as Primary Navigation\nNo folders. No tags as the primary interface. A stack of recently-touched documents with AI handling connections to historical context. The \"filing\" problem disappears for the user.", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "6", "text": "---\n\n## Design Principles\n\n### Zero Friction Capture\nThe system must feel as fast as opening a new Notepad++ tab. No formatting required. No decisions about where to file. Just start typing.\n\n### Recency as Primary Navigation\nNo folders. No tags as the primary interface. A stack of recently-touched documents with AI handling connections to historical context. The \"filing\" problem disappears for the user.\n\n### The AI is a Librarian, Not a Secretary\nThe AI notices patterns, suggests consolidations, and maintains coherence across time. The human approves; the AI proposes.\n\n### Context-Aware Task Intelligence\n\"What's next?\" isn't just a sorted to-do list. It's aware of what you were *just* doing, what's open, and what would be efficient to continue vs. switch away from.\n\n### Asynchronous Processing\nThe system works in the background. You return to a tidied state, not a backlog of organizational debt.\n\n---\n\n## Entities", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "7", "text": "### Context-Aware Task Intelligence\n\"What's next?\" isn't just a sorted to-do list. It's aware of what you were *just* doing, what's open, and what would be efficient to continue vs. switch away from.\n\n### Asynchronous Processing\nThe system works in the background. You return to a tidied state, not a backlog of organizational debt.\n\n---\n\n## Entities\n\n| Entity | Description |\n|--------|-------------|\n| **Fragment** | Raw, timestamped text capture. The atomic unit. Lives as a markdown file. |\n| **Note** | Consolidated reference document. Has standard structure after processing. Also a markdown file. |\n| **Task** | A `TODO` or `TASK` marker inline in any document. Not a separate record—identified by semantic marker in text. |\n| **Project** | A note that serves as a container/hub for related work. May have its own inline TODOs. |\n\n---\n\n## Storage Architecture\n\n### Canonical Store: Git Repository", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "8", "text": "| Entity | Description |\n|--------|-------------|\n| **Fragment** | Raw, timestamped text capture. The atomic unit. Lives as a markdown file. |\n| **Note** | Consolidated reference document. Has standard structure after processing. Also a markdown file. |\n| **Task** | A `TODO` or `TASK` marker inline in any document. Not a separate record—identified by semantic marker in text. |\n| **Project** | A note that serves as a container/hub for related work. May have its own inline TODOs. |\n\n---\n\n## Storage Architecture\n\n### Canonical Store: Git Repository\n\nAll content lives as markdown files in a git repository.\n\n- **Location:** Server-side git repo\n- **File format:** Markdown (.md)\n- **File naming:** Flat structure with names taken from the title of the note, but with UUID or timestamp appended to ensure conflict free saving of possibly similarly named notes\n- **History:** Full git history provides unlimited undo\n- **Diffs:** Git diff for reviewing proposed changes", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "9", "text": "---\n\n## Storage Architecture\n\n### Canonical Store: Git Repository\n\nAll content lives as markdown files in a git repository.\n\n- **Location:** Server-side git repo\n- **File format:** Markdown (.md)\n- **File naming:** Flat structure with names taken from the title of the note, but with UUID or timestamp appended to ensure conflict free saving of possibly similarly named notes\n- **History:** Full git history provides unlimited undo\n- **Diffs:** Git diff for reviewing proposed changes\n\n### Index: SQLite Database\n\nA derived index for fast querying, rebuildable from the git repo at any time.\n\n**Index contains:**\n- File paths and metadata (created, last modified)\n- Extracted TODO/TASK items with:\n  - Source file path\n  - Line number\n  - Extracted text\n  - Inferred project association\n  - Timestamp (from git history)\n- Embeddings for semantic search (cached by content hash)\n- Unresolved `[QUESTION: ...]` blocks\n\n---\n\n## Core Behaviors\n\n### Capture", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "10", "text": "### Index: SQLite Database\n\nA derived index for fast querying, rebuildable from the git repo at any time.\n\n**Index contains:**\n- File paths and metadata (created, last modified)\n- Extracted TODO/TASK items with:\n  - Source file path\n  - Line number\n  - Extracted text\n  - Inferred project association\n  - Timestamp (from git history)\n- Embeddings for semantic search (cached by content hash)\n- Unresolved `[QUESTION: ...]` blocks\n\n---\n\n## Core Behaviors\n\n### Capture\n\n- Create new fragment instantly via button or `Cmd+N`\n- Auto-save continuously (no manual save required)\n- No formatting or organization required\n- System assigns timestamp-based identifier\n\n### Task Marking", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "11", "text": "---\n\n## Core Behaviors\n\n### Capture\n\n- Create new fragment instantly via button or `Cmd+N`\n- Auto-save continuously (no manual save required)\n- No formatting or organization required\n- System assigns timestamp-based identifier\n\n### Task Marking\n\n- Write `TODO` or `TASK` inline anywhere in a document\n- AI infers project context from surrounding content\n- If context is ambiguous, AI inserts `[QUESTION: Which project does this relate to?]`\n- Tasks should follow SMART principles (Specific, Measurable, Actionable, Relevant, Time-bound)\n- AI helps enforce SMART criteria during consolidation\n\n### Task Completion\n\n- Write `DONE` next to the item\n- Inline is authoritative—the master list reflects this automatically\n- Zombie tasks (old, unmarked) are surfaced in morning summary\n\n### Master TODO List", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "12", "text": "### Task Marking\n\n- Write `TODO` or `TASK` inline anywhere in a document\n- AI infers project context from surrounding content\n- If context is ambiguous, AI inserts `[QUESTION: Which project does this relate to?]`\n- Tasks should follow SMART principles (Specific, Measurable, Actionable, Relevant, Time-bound)\n- AI helps enforce SMART criteria during consolidation\n\n### Task Completion\n\n- Write `DONE` next to the item\n- Inline is authoritative—the master list reflects this automatically\n- Zombie tasks (old, unmarked) are surfaced in morning summary\n\n### Master TODO List\n\n- A live view/query across all documents\n- Read-through interface: click to jump to source document at the relevant line\n- No direct editing in the master list\n- Sorted by recency (default), can group by project\n- Shows: TODO text, source document, inferred project, timestamp\n\n### Consolidation\n\n**Trigger:** Manual button click (automated triggers can be added later)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "13", "text": "### Consolidation\n\n**Trigger:** Manual button click (automated triggers can be added later)\n\n**Process:**\n1. User clicks \"Consolidate\" on a document (or selects multiple fragments)\n2. AI processes content:\n   - Cleans up formatting\n   - Removes redundant information\n   - Identifies contradictions or unclear statements → inserts `[QUESTION: ...]` blocks\n   - Structures into standard format\n   - Merges semantically similar content\n3. System creates a git branch with proposed changes\n4. User sees diff view (side-by-side preferred)\n5. User can:\n   - **Accept** → merge to main, rebuild index\n   - **Edit** → modify proposal before accepting\n   - **Reject** → discard branch, no changes\n6. On accept, index rebuilds automatically\n\n### Standard Note Structure (Post-Consolidation)\n\n```markdown\n# Title\n\n## Summary\n[AI-generated summary of the entire note]\n\n## Details\n[Organized content sections]", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "14", "text": "### Standard Note Structure (Post-Consolidation)\n\n```markdown\n# Title\n\n## Summary\n[AI-generated summary of the entire note]\n\n## Details\n[Organized content sections]\n\n## Open Questions\n[AI-generated or carried forward from [QUESTION: ...] blocks]\n\n## TODOs\n[Extracted from throughout, or manually listed]\n```\n\n### Clarifications\n\n- AI inserts `[QUESTION: ...]` inline during consolidation\n- Questions become part of the document until resolved\n- User answers by editing the document\n- Optional summary view aggregates all unresolved questions\n\n### Semantic Search\n\n- Query bar searches across all content using embeddings\n- Results show: document title, snippet with match highlighted\n- Clicking opens document scrolled to match\n\n### Related Context (\"Find Related\")\n\n- Manual button on any document\n- Surfaces documents with high semantic similarity\n- Option to \"Merge into current\" (concatenates for later consolidation)\n\n### Morning Summary / \"What's Next?\"\n\nDefault landing page when app opens. Displays:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "15", "text": "### Semantic Search\n\n- Query bar searches across all content using embeddings\n- Results show: document title, snippet with match highlighted\n- Clicking opens document scrolled to match\n\n### Related Context (\"Find Related\")\n\n- Manual button on any document\n- Surfaces documents with high semantic similarity\n- Option to \"Merge into current\" (concatenates for later consolidation)\n\n### Morning Summary / \"What's Next?\"\n\nDefault landing page when app opens. Displays:\n\n- **Yesterday's Activity:** Documents touched, TODOs completed\n- **Open TODOs:** Listed with project context, sorted by age/priority\n- **Suggested Next Action:** Based on recency, open items, TODO age\n- **Open Questions:** Aggregated `[QUESTION: ...]` blocks awaiting input\n\n---\n\n## User Interface\n\n### Primary View: The Stack", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "16", "text": "### Morning Summary / \"What's Next?\"\n\nDefault landing page when app opens. Displays:\n\n- **Yesterday's Activity:** Documents touched, TODOs completed\n- **Open TODOs:** Listed with project context, sorted by age/priority\n- **Suggested Next Action:** Based on recency, open items, TODO age\n- **Open Questions:** Aggregated `[QUESTION: ...]` blocks awaiting input\n\n---\n\n## User Interface\n\n### Primary View: The Stack\n\n**Left Panel (narrow):** Recent documents list\n- Vertical list of recently-touched documents, most recent at top\n- Each item shows:\n  - Title (or first line if untitled)\n  - Timestamp\n  - Type icon (fragment/note/project)\n  - Visual indicator for unresolved questions\n  - Visual indicator for open TODOs\n- Click to open in main editor\n\n**Main Panel (wide):** Editor\n- Markdown editing, minimal chrome\n- Auto-saves continuously\n- Clean, distraction-free writing area", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "17", "text": "---\n\n## User Interface\n\n### Primary View: The Stack\n\n**Left Panel (narrow):** Recent documents list\n- Vertical list of recently-touched documents, most recent at top\n- Each item shows:\n  - Title (or first line if untitled)\n  - Timestamp\n  - Type icon (fragment/note/project)\n  - Visual indicator for unresolved questions\n  - Visual indicator for open TODOs\n- Click to open in main editor\n\n**Main Panel (wide):** Editor\n- Markdown editing, minimal chrome\n- Auto-saves continuously\n- Clean, distraction-free writing area\n\n**Top Bar (minimal):**\n- Search box (semantic search)\n- \"New\" button (or `Cmd+N`)\n- \"Consolidate\" button\n- \"Find Related\" button\n- \"Master TODO\" button\n- Search shortcut: `Cmd+S`\n\n### Master TODO View", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "18", "text": "**Main Panel (wide):** Editor\n- Markdown editing, minimal chrome\n- Auto-saves continuously\n- Clean, distraction-free writing area\n\n**Top Bar (minimal):**\n- Search box (semantic search)\n- \"New\" button (or `Cmd+N`)\n- \"Consolidate\" button\n- \"Find Related\" button\n- \"Master TODO\" button\n- Search shortcut: `Cmd+S`\n\n### Master TODO View\n\n- Focused list of all open TODOs\n- Each item shows:\n  - TODO text\n  - Source document (clickable)\n  - Inferred project\n  - Timestamp\n- Click to jump to source location\n- Read-only view (edit at source)\n\n### Consolidation Modal", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "19", "text": "**Top Bar (minimal):**\n- Search box (semantic search)\n- \"New\" button (or `Cmd+N`)\n- \"Consolidate\" button\n- \"Find Related\" button\n- \"Master TODO\" button\n- Search shortcut: `Cmd+S`\n\n### Master TODO View\n\n- Focused list of all open TODOs\n- Each item shows:\n  - TODO text\n  - Source document (clickable)\n  - Inferred project\n  - Timestamp\n- Click to jump to source location\n- Read-only view (edit at source)\n\n### Consolidation Modal\n\n1. Processing indicator while AI works\n2. Diff view appears:\n   - Side-by-side diff (preferred)\n   - Green = additions, red = deletions\n   - `[QUESTION: ...]` blocks highlighted\n3. Actions:\n   - Accept → commits changes\n   - Edit → opens proposed version for manual tweaking\n   - Reject → discards, no change\n\n### Search Results Panel", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "20", "text": "### Consolidation Modal\n\n1. Processing indicator while AI works\n2. Diff view appears:\n   - Side-by-side diff (preferred)\n   - Green = additions, red = deletions\n   - `[QUESTION: ...]` blocks highlighted\n3. Actions:\n   - Accept → commits changes\n   - Edit → opens proposed version for manual tweaking\n   - Reject → discards, no change\n\n### Search Results Panel\n\n- Appears on search\n- Results show: title, snippet with highlighted match\n- Click to open document at match location\n\n### \"Find Related\" Panel\n\n- Shows semantically similar documents\n- Each result: title, brief summary, similarity indicator\n- \"Merge into current\" option\n\n### Morning Summary View\n\n- Default landing page\n- Yesterday's activity summary\n- Open TODOs with context\n- Suggested next action\n- Aggregated open questions\n\n---\n\n## Background Processes\n\n### Process 1: Index Rebuild", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "21", "text": "### Search Results Panel\n\n- Appears on search\n- Results show: title, snippet with highlighted match\n- Click to open document at match location\n\n### \"Find Related\" Panel\n\n- Shows semantically similar documents\n- Each result: title, brief summary, similarity indicator\n- \"Merge into current\" option\n\n### Morning Summary View\n\n- Default landing page\n- Yesterday's activity summary\n- Open TODOs with context\n- Suggested next action\n- Aggregated open questions\n\n---\n\n## Background Processes\n\n### Process 1: Index Rebuild\n\n**Trigger:** On file save (debounced to a reasonable time period to prevent overload. This debounce interval should be configurable), or on-demand\n\n**Steps:**\n1. Scan git repo for all markdown files\n2. For each file:\n   - Extract metadata (title, timestamps from git log)\n   - Extract TODO/TASK lines with line numbers\n   - Generate or update embedding for semantic search\n3. Update SQLite index\n\n**Performance:** Cache embeddings by content hash. Only regenerate on content change.", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "22", "text": "---\n\n## Background Processes\n\n### Process 1: Index Rebuild\n\n**Trigger:** On file save (debounced to a reasonable time period to prevent overload. This debounce interval should be configurable), or on-demand\n\n**Steps:**\n1. Scan git repo for all markdown files\n2. For each file:\n   - Extract metadata (title, timestamps from git log)\n   - Extract TODO/TASK lines with line numbers\n   - Generate or update embedding for semantic search\n3. Update SQLite index\n\n**Performance:** Cache embeddings by content hash. Only regenerate on content change.\n\n### Process 2: Consolidation\n\n**Trigger:** Manual (user clicks button)\n\n**Input:** Single document or selected fragments\n\n**Steps:**\n1. Read current content\n2. Send to AI with consolidation prompt\n3. AI returns proposed structured content\n4. Create git branch, write proposed content\n5. Present diff to user\n6. On accept: merge branch, rebuild index\n7. On reject: delete branch\n\n### Process 3: Related Document Finder", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "23", "text": "**Performance:** Cache embeddings by content hash. Only regenerate on content change.\n\n### Process 2: Consolidation\n\n**Trigger:** Manual (user clicks button)\n\n**Input:** Single document or selected fragments\n\n**Steps:**\n1. Read current content\n2. Send to AI with consolidation prompt\n3. AI returns proposed structured content\n4. Create git branch, write proposed content\n5. Present diff to user\n6. On accept: merge branch, rebuild index\n7. On reject: delete branch\n\n### Process 3: Related Document Finder\n\n**Trigger:** Manual (\"Find Related\" button)\n\n**Steps:**\n1. Get embedding of current document\n2. Query index for top N similar documents (cosine similarity)\n3. Return results for display\n\n### Process 4: Master TODO Aggregation\n\n**Trigger:** On-demand or after index rebuild", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "24", "text": "### Process 3: Related Document Finder\n\n**Trigger:** Manual (\"Find Related\" button)\n\n**Steps:**\n1. Get embedding of current document\n2. Query index for top N similar documents (cosine similarity)\n3. Return results for display\n\n### Process 4: Master TODO Aggregation\n\n**Trigger:** On-demand or after index rebuild\n\n**Steps:**\n1. Query index for all TODO/TASK entries without DONE marker\n2. For each, resolve: source file, line number, inferred project, timestamp\n3. Sort by recency (default)\n4. Return for display\n\n### Process 5: Morning Summary Generation\n\n**Trigger:** Manual or scheduled (daily)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "25", "text": "**Steps:**\n1. Get embedding of current document\n2. Query index for top N similar documents (cosine similarity)\n3. Return results for display\n\n### Process 4: Master TODO Aggregation\n\n**Trigger:** On-demand or after index rebuild\n\n**Steps:**\n1. Query index for all TODO/TASK entries without DONE marker\n2. For each, resolve: source file, line number, inferred project, timestamp\n3. Sort by recency (default)\n4. Return for display\n\n### Process 5: Morning Summary Generation\n\n**Trigger:** Manual or scheduled (daily)\n\n**Steps:**\n1. Query git log for files modified in last 24 hours\n2. Query index for TODOs marked DONE in last 24 hours\n3. Query index for open TODOs, sorted by age\n4. Query index for unresolved `[QUESTION: ...]` blocks\n5. Optionally: send to AI for natural-language summary\n6. Return for display\n\n---\n\n## Multi-Device Sync", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "26", "text": "### Process 5: Morning Summary Generation\n\n**Trigger:** Manual or scheduled (daily)\n\n**Steps:**\n1. Query git log for files modified in last 24 hours\n2. Query index for TODOs marked DONE in last 24 hours\n3. Query index for open TODOs, sorted by age\n4. Query index for unresolved `[QUESTION: ...]` blocks\n5. Optionally: send to AI for natural-language summary\n6. Return for display\n\n---\n\n## Multi-Device Sync\n\n### Strategy: Polling with Last-Write-Wins\n\n- Web app polls server every ~15 seconds for changes\n- If server has newer version than local:\n  - Display warning to user\n  - Allow user to copy local changes before accepting server version\n- Most recent write always takes precedence\n- No real-time collaboration (single user assumed)\n- Conflict scenario: User opens on laptop, writes, closes lid, adds more on phone\n  - Phone version wins (most recent)\n  - Warning shown if laptop had unsaved changes\n\n---", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "27", "text": "---\n\n## Multi-Device Sync\n\n### Strategy: Polling with Last-Write-Wins\n\n- Web app polls server every ~15 seconds for changes\n- If server has newer version than local:\n  - Display warning to user\n  - Allow user to copy local changes before accepting server version\n- Most recent write always takes precedence\n- No real-time collaboration (single user assumed)\n- Conflict scenario: User opens on laptop, writes, closes lid, adds more on phone\n  - Phone version wins (most recent)\n  - Warning shown if laptop had unsaved changes\n\n---\n\n## Technical Stack (Recommended)\n\n### Frontend\n- Web app (PWA-capable)\n- Framework: Vanilla JS, or lightweight framework (Preact/Svelte)\n- Markdown editor component\n- Diff viewer library (for consolidation review)\n\n### Backend\n- Node.js or Python server\n- Git operations via library (simple-git, gitpython)\n- SQLite for index\n- REST API for frontend communication", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "28", "text": "---\n\n## Technical Stack (Recommended)\n\n### Frontend\n- Web app (PWA-capable)\n- Framework: Vanilla JS, or lightweight framework (Preact/Svelte)\n- Markdown editor component\n- Diff viewer library (for consolidation review)\n\n### Backend\n- Node.js or Python server\n- Git operations via library (simple-git, gitpython)\n- SQLite for index\n- REST API for frontend communication\n\n### AI/Embeddings\n- Configurable via `config.json`\n- Options: Local model (LEANN, sentence-transformers), or API (OpenAI, Anthropic)\n- LLM for consolidation: Configurable (Claude API, local model)\n\n### Hosting\n- VPS deployment\n- Git repo on server\n- SQLite database on server\n\n---\n\n## Configuration\n\n`config.json` structure:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "29", "text": "### Hosting\n- VPS deployment\n- Git repo on server\n- SQLite database on server\n\n---\n\n## Configuration\n\n`config.json` structure:\n\n```json\n{\n  \"storage\": {\n    \"git_repo_path\": \"/path/to/notes-repo\",\n    \"sqlite_db_path\": \"/path/to/index.db\"\n  },\n  \"embeddings\": {\n    \"provider\": \"local\",\n    \"model\": \"all-MiniLM-L6-v2\",\n    \"api_key\": null\n  },\n  \"llm\": {\n    \"provider\": \"anthropic\",\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"api_key\": \"${ANTHROPIC_API_KEY}\"\n  },\n  \"sync\": {\n    \"poll_interval_seconds\": 15\n  },\n  \"ui\": {\n    \"default_view\": \"morning_summary\"\n  }\n}\n```\n\n---\n\n## Future Enhancements (Out of Scope for v1)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "30", "text": "---\n\n## Future Enhancements (Out of Scope for v1)\n\n- Automated consolidation triggers (nightly, after N fragments)\n- \"Clippy\" mode: proactive suggestions while writing\n- External context integration (git commits, calendar)\n- Check-in/reminder system (separate Pomodoro app with API access)\n- Folder organization (AI-managed)\n- Mobile-native apps\n- Voice capture\n\n---\n\n## Reference: Previous Implementation\n\nA previous attempt exists at: https://github.com/andocmdo/focus-notes\n\nThis repo contains:\n- PWA setup patterns\n- Icon assets\n- JSON data file examples\n- HTML templates\n\nThese may be useful for reference during implementation, particularly for UI patterns that worked well.\n\n---\n\n## Success Criteria\n\nThe system succeeds if:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "31", "text": "---\n\n## Reference: Previous Implementation\n\nA previous attempt exists at: https://github.com/andocmdo/focus-notes\n\nThis repo contains:\n- PWA setup patterns\n- Icon assets\n- JSON data file examples\n- HTML templates\n\nThese may be useful for reference during implementation, particularly for UI patterns that worked well.\n\n---\n\n## Success Criteria\n\nThe system succeeds if:\n\n1. **Capture latency < 2 seconds** from intent to typing\n2. **Zero required formatting** at capture time\n3. **All content searchable** via semantic search\n4. **Morning summary useful** for daily planning\n5. **Consolidation produces clean, readable notes** from messy fragments\n6. **No lost data** due to sync issues (git history as safety net)\n7. **Works on desktop and mobile** via PWA\n\n---\n\n*Document version: 1.0*\n*Last updated: Based on design session conversations*", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/braindump-spec.md", "file_name": "braindump-spec.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "32", "text": "# Claude Code Kickoff Prompt: Braindump\n\nUse this prompt to initialize development with Claude Code.\n\n---\n\n## Initial Prompt\n\n```\nI'm starting a new project called \"Braindump\" - a personal knowledge base system with AI-powered consolidation. I have a complete specification document that I'll share with you.\n\n**Project Overview:**\nBraindump is a low-friction capture system where I can quickly write notes (like opening a Notepad++ tab), and an AI background process cleans, consolidates, and organizes them. It also tracks TODO items inline in documents.\n\n**Core Architecture:**\n- Git repository as canonical store (all notes are markdown files)\n- SQLite index for fast queries and semantic search\n- Web app frontend (PWA-capable)\n- REST API backend\n- Manual consolidation trigger (AI proposes changes, shown as git diff)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "33", "text": "**Core Architecture:**\n- Git repository as canonical store (all notes are markdown files)\n- SQLite index for fast queries and semantic search\n- Web app frontend (PWA-capable)\n- REST API backend\n- Manual consolidation trigger (AI proposes changes, shown as git diff)\n\n**Key Features:**\n1. Zero-friction capture: New fragment instantly, auto-save, no formatting required\n2. TODO tracking: `TODO` or `TASK` markers inline, `DONE` to complete\n3. Master TODO list: Aggregated view across all documents (read-through, click to source)\n4. Consolidation: Manual trigger, AI structures messy notes, git diff for review/approval\n5. Semantic search: Query all content via embeddings\n6. Morning summary: Yesterday's activity, open TODOs, suggested next action\n7. Multi-device: Polling sync (~15s), last-write-wins with warning", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "34", "text": "**Tech Decisions:**\n- Backend: Node.js or Python (your recommendation welcome, although leaning towards very simple/basic Python setup, prioritizing simplicity and readability, rather than performance or abstraction and complex code architecture)\n- Git operations: simple-git (Node) or gitpython (Python)\n- Embeddings: Configurable via config.json (local model or API)\n- LLM: Configurable (Claude API for consolidation)\n- Frontend: Lightweight - vanilla JS (or Preact/Svelte or similar if needed to achieve the technical requirements of the user interface)\n- Diff viewer: Use existing library (if possible and expedient).\n\n**File Structure:**\n- Flat file naming (title of note + UUID or simple timestamp) in git repo\n- Standard note structure post-consolidation:\n  - # Title\n  - ## Summary\n  - ## Details\n  - ## Open Questions\n  - ## TODOs", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "35", "text": "**File Structure:**\n- Flat file naming (title of note + UUID or simple timestamp) in git repo\n- Standard note structure post-consolidation:\n  - # Title\n  - ## Summary\n  - ## Details\n  - ## Open Questions\n  - ## TODOs\n\n**What I need first:**\n1. Project scaffolding with recommended structure\n2. Configuration file setup (config.json)\n3. Git repository initialization logic\n4. Basic REST API skeleton\n5. Simple frontend with:\n   - Left panel: recent documents list\n   - Main panel: markdown editor with auto-save\n   - Top bar: New, Search, Consolidate buttons\n\n**Reference:**\nI have a previous attempt at: https://github.com/andocmdo/focus-notes\nSome UI patterns from there may be useful. Specifically the auto save feature, the clean and simple \ntabs of documents and the text editing area.", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "36", "text": "**Reference:**\nI have a previous attempt at: https://github.com/andocmdo/focus-notes\nSome UI patterns from there may be useful. Specifically the auto save feature, the clean and simple \ntabs of documents and the text editing area. \n\nPlease start by:\n1. Recommending the tech stack (Node vs Python for backend, frontend framework choice)\n2. Proposing a project directory structure\n3. Creating the initial scaffolding\n\nYou can always reference the braindump-spec.md in the current root folder of this project which contains all the above information (and sometimes more specific details).\n\nI'll be hosting this on my VPS. Let's build incrementally - get the basic capture and display working first, then add features.\n\nPlease think deeply about implmenting this and then we will get started.\n```\n\n---\n\n## Follow-up Prompts\n\n### After Initial Scaffolding\n\n```\nGreat. Now let's implement the core capture flow:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "37", "text": "You can always reference the braindump-spec.md in the current root folder of this project which contains all the above information (and sometimes more specific details).\n\nI'll be hosting this on my VPS. Let's build incrementally - get the basic capture and display working first, then add features.\n\nPlease think deeply about implmenting this and then we will get started.\n```\n\n---\n\n## Follow-up Prompts\n\n### After Initial Scaffolding\n\n```\nGreat. Now let's implement the core capture flow:\n\n1. \"New Fragment\" button creates a new markdown file with timestamp-based name\n2. Auto-save: debounced save on every keystroke (500ms delay)\n3. Git commit on save (or batched commits)\n4. Recent documents list updates to show new/modified files\n5. Click document in list to open in editor\n\nKeep it simple - no consolidation or search yet. Just capture and retrieve.\n```\n\n### Adding the Index\n\n```\nNow let's add the SQLite index:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "38", "text": "### After Initial Scaffolding\n\n```\nGreat. Now let's implement the core capture flow:\n\n1. \"New Fragment\" button creates a new markdown file with timestamp-based name\n2. Auto-save: debounced save on every keystroke (500ms delay)\n3. Git commit on save (or batched commits)\n4. Recent documents list updates to show new/modified files\n5. Click document in list to open in editor\n\nKeep it simple - no consolidation or search yet. Just capture and retrieve.\n```\n\n### Adding the Index\n\n```\nNow let's add the SQLite index:\n\n1. On file save, update index with:\n   - File path\n   - Title (first line or filename)\n   - Last modified timestamp\n   - Extracted TODO lines with line numbers\n2. Index rebuild command that scans all files\n3. Update recent documents list to query from index instead of filesystem\n```\n\n### Adding TODO Tracking\n\n```\nLet's add TODO extraction and the master list:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "39", "text": "Keep it simple - no consolidation or search yet. Just capture and retrieve.\n```\n\n### Adding the Index\n\n```\nNow let's add the SQLite index:\n\n1. On file save, update index with:\n   - File path\n   - Title (first line or filename)\n   - Last modified timestamp\n   - Extracted TODO lines with line numbers\n2. Index rebuild command that scans all files\n3. Update recent documents list to query from index instead of filesystem\n```\n\n### Adding TODO Tracking\n\n```\nLet's add TODO extraction and the master list:\n\n1. When indexing, find all lines containing TODO or TASK (not followed by DONE)\n2. Store: file path, line number, todo text, timestamp\n3. Create Master TODO view:\n   - List all open TODOs\n   - Each item shows: text, source file (clickable), timestamp\n   - Click jumps to source file at that line\n```\n\n### Adding Semantic Search\n\n```\nNow let's add semantic search:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "40", "text": "### Adding TODO Tracking\n\n```\nLet's add TODO extraction and the master list:\n\n1. When indexing, find all lines containing TODO or TASK (not followed by DONE)\n2. Store: file path, line number, todo text, timestamp\n3. Create Master TODO view:\n   - List all open TODOs\n   - Each item shows: text, source file (clickable), timestamp\n   - Click jumps to source file at that line\n```\n\n### Adding Semantic Search\n\n```\nNow let's add semantic search:\n\n1. Set up embedding generation (use config.json for provider selection)\n2. On index rebuild, generate embedding for each document\n3. Cache embeddings by content hash (skip regeneration if unchanged)\n4. Add search endpoint: query embedding -> cosine similarity -> top N results\n5. Frontend: search box that shows results panel\n6. Click result to open document\n```\n\n### Adding Consolidation\n\n```\nNow the big feature - consolidation:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "41", "text": "### Adding Semantic Search\n\n```\nNow let's add semantic search:\n\n1. Set up embedding generation (use config.json for provider selection)\n2. On index rebuild, generate embedding for each document\n3. Cache embeddings by content hash (skip regeneration if unchanged)\n4. Add search endpoint: query embedding -> cosine similarity -> top N results\n5. Frontend: search box that shows results panel\n6. Click result to open document\n```\n\n### Adding Consolidation\n\n```\nNow the big feature - consolidation:\n\n1. \"Consolidate\" button on current document\n2. Backend:\n   - Create git branch\n   - Send document content to LLM with consolidation prompt\n   - Write proposed content to branch\n   - Return diff between main and branch\n3. Frontend:\n   - Show diff view (use diff2html or similar library)\n   - Accept/Edit/Reject buttons\n4. On accept: merge branch, rebuild index\n5. On reject: delete branch", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "42", "text": "### Adding Consolidation\n\n```\nNow the big feature - consolidation:\n\n1. \"Consolidate\" button on current document\n2. Backend:\n   - Create git branch\n   - Send document content to LLM with consolidation prompt\n   - Write proposed content to branch\n   - Return diff between main and branch\n3. Frontend:\n   - Show diff view (use diff2html or similar library)\n   - Accept/Edit/Reject buttons\n4. On accept: merge branch, rebuild index\n5. On reject: delete branch\n\nConsolidation prompt should:\n- Clean up formatting\n- Remove redundancy\n- Structure into: Summary, Details, Open Questions, TODOs\n- Insert [QUESTION: ...] for ambiguities\n```\n\n### Adding Morning Summary\n\n```\nLet's add the morning summary view:", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "43", "text": "Consolidation prompt should:\n- Clean up formatting\n- Remove redundancy\n- Structure into: Summary, Details, Open Questions, TODOs\n- Insert [QUESTION: ...] for ambiguities\n```\n\n### Adding Morning Summary\n\n```\nLet's add the morning summary view:\n\n1. Query git log for files modified in last 24 hours\n2. Query index for TODOs marked DONE recently\n3. Query index for open TODOs sorted by age\n4. Query for unresolved [QUESTION: ...] blocks\n5. Display as landing page:\n   - Yesterday's activity\n   - Open TODOs\n   - Open questions\n6. Optionally: send to LLM for natural language summary\n```\n\n---\n\n## Key Reminders for Development", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "44", "text": "1. Query git log for files modified in last 24 hours\n2. Query index for TODOs marked DONE recently\n3. Query index for open TODOs sorted by age\n4. Query for unresolved [QUESTION: ...] blocks\n5. Display as landing page:\n   - Yesterday's activity\n   - Open TODOs\n   - Open questions\n6. Optionally: send to LLM for natural language summary\n```\n\n---\n\n## Key Reminders for Development\n\n- **Git is truth**: All notes live as markdown in git. Database is derived.\n- **Auto-save always**: Never require manual save\n- **Inline is authoritative**: TODOs live in documents, master list is a view\n- **Manual triggers first**: Automate later after patterns are clear\n- **Flat files**: No folders for v1, just timestamps/UUIDs\n- **Config-driven**: Embedding provider, LLM provider in config.json\n- **PWA-capable**: Service worker, manifest for mobile install\n\n---\n\n## Config Template", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "45", "text": "---\n\n## Config Template\n\n```json\n{\n  \"storage\": {\n    \"git_repo_path\": \"./data/notes\",\n    \"sqlite_db_path\": \"./data/index.db\"\n  },\n  \"embeddings\": {\n    \"provider\": \"local\",\n    \"model\": \"all-MiniLM-L6-v2\",\n    \"api_key\": null\n  },\n  \"llm\": {\n    \"provider\": \"anthropic\",\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"api_key\": \"${ANTHROPIC_API_KEY}\"\n  },\n  \"server\": {\n    \"port\": 3000,\n    \"host\": \"0.0.0.0\"\n  },\n  \"sync\": {\n    \"poll_interval_seconds\": 15\n  },\n  \"ui\": {\n    \"default_view\": \"morning_summary\",\n    \"autosave_delay_ms\": 500\n  }\n}\n```", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/claude-code-kickoff.md", "file_name": "claude-code-kickoff.md", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "46", "text": "{\n  \"storage\": {\n    \"git_repo_path\": \"./data/notes\",\n    \"sqlite_db_path\": \"./data/index.db\"\n  },\n  \"embeddings\": {\n    \"provider\": \"local\",\n    \"model\": \"all-MiniLM-L6-v2\",\n    \"api_key\": null\n  },\n  \"llm\": {\n    \"provider\": \"openrouter\",\n    \"model\": \"anthropic/claude-3.5-sonnet\",\n    \"api_key\": \"${OPENROUTER_API_KEY}\",\n    \"site_url\": \"\",\n    \"site_name\": \"Braindump\"\n  },\n  \"server\": {\n    \"port\": 3000,\n    \"host\": \"0.0.0.0\",\n    \"debug\": false\n  },\n  \"sync\": {\n    \"poll_interval_seconds\": 15\n  },\n  \"index\": {\n    \"rebuild_debounce_seconds\": 5\n  },\n  \"ui\": {\n    \"default_view\": \"recent\",\n    \"autosave_delay_ms\": 500\n  }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/config.example.json", "file_name": "config.example.json", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "47", "text": "def main():\n    print(\"Hello from braindump!\")\n\n\nif __name__ == \"__main__\":\n    main()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/main.py", "file_name": "main.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "48", "text": "[project]\nname = \"braindump\"\nversion = \"0.1.0\"\ndescription = \"Personal knowledge capture system with AI-driven consolidation\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"anthropic>=0.75.0\",\n    \"flask>=3.1.2\",\n    \"gitpython>=3.1.46\",\n    \"httpx>=0.28.1\",\n    \"python-dotenv>=1.2.1\",\n    \"sentence-transformers>=5.2.0\",\n]\n\n[project.scripts]\nbraindump = \"server.app:main\"\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"\n\n[tool.hatch.build.targets.wheel]\npackages = [\"server\"]", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/pyproject.toml", "file_name": "pyproject.toml", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "49", "text": "# Braindump server package", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/__init__.py", "file_name": "__init__.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "50", "text": "\"\"\"\nBraindump API Server\n\nA simple Flask server providing REST API for the Braindump knowledge base.\n\"\"\"\n\nimport json\nimport os\nfrom pathlib import Path\nfrom datetime import datetime\nimport uuid\n\nfrom flask import Flask, request, jsonify, send_from_directory\nfrom dotenv import load_dotenv\n\nfrom server.git_ops import GitOps\nfrom server.indexer import Indexer\nfrom server.embeddings import EmbeddingManager\nfrom server.llm import LLMManager\nfrom server.consolidation import ConsolidationManager\n\nload_dotenv()\n\napp = Flask(__name__, static_folder='../web', static_url_path='')\n\n# Load configuration\nCONFIG_PATH = Path(__file__).parent.parent / 'config.json'\nCONFIG_EXAMPLE_PATH = Path(__file__).parent.parent / 'config.example.json'\n\ndef load_config():\n    \"\"\"Load config from config.json, falling back to example if not found.\"\"\"\n    if CONFIG_PATH.exists():\n        with open(CONFIG_PATH) as f:\n            return json.load(f)\n    elif CONFIG_EXAMPLE_PATH.exists():\n        with open(CONFIG_EXAMPLE_PATH) as f:\n            return json.load(f)\n    else:\n        raise FileNotFoundError(\"No config.json or config.example.json found\")\n\nconfig = load_config()\n\n# Initialize paths\nREPO_PATH = Path(config['storage']['git_repo_path'])\nDB_PATH = Path(config['storage']['sqlite_db_path'])\n\n# Ensure data directories exist\nREPO_PATH.parent.mkdir(parents=True, exist_ok=True)\nDB_PATH.parent.mkdir(parents=True, exist_ok=True)\n\n# Initialize git operations\ngit_ops = GitOps(REPO_PATH)\n\n# Initialize embedding manager (lazy - only loads model when needed)\nembedding_manager = None\n\ndef get_embedding_manager():\n    \"\"\"Get or initialize the embedding manager.\"\"\"\n    global embedding_manager\n    if embedding_manager is None:\n        print(\"Initializing embedding manager...\")\n        embedding_manager = EmbeddingManager(config.get('embeddings', {}))\n    return embedding_manager\n\n\n# Initialize LLM manager (lazy - only loads when consolidation is needed)\nllm_manager = None\nconsolidation_manager = None", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "51", "text": "# Initialize LLM manager (lazy - only loads when consolidation is needed)\nllm_manager = None\nconsolidation_manager = None\n\ndef get_llm_manager():\n    \"\"\"Get or initialize the LLM manager.\"\"\"\n    global llm_manager\n    if llm_manager is None:\n        print(\"Initializing LLM manager...\")\n        llm_manager = LLMManager(config.get('llm', {}))\n    return llm_manager\n\ndef get_consolidation_manager():\n    \"\"\"Get or initialize the consolidation manager.\"\"\"\n    global consolidation_manager\n    if consolidation_manager is None:\n        consolidation_manager = ConsolidationManager(get_llm_manager(), git_ops)\n    return consolidation_manager\n\n# Initialize indexer (without embeddings initially for fast startup)\nindexer = Indexer(DB_PATH, REPO_PATH)\n\n\n# --- Static file serving ---\n\n@app.route('/')\ndef serve_index():\n    \"\"\"Serve the main app.\"\"\"\n    return send_from_directory(app.static_folder, 'index.html')\n\n\n# --- Document API ---\n\n@app.route('/api/documents', methods=['GET'])\ndef list_documents():\n    \"\"\"List all documents, sorted by last modified (most recent first).\"\"\"\n    documents = []\n\n    if not REPO_PATH.exists():\n        return jsonify([])\n\n    for md_file in REPO_PATH.glob('*.md'):\n        stat = md_file.stat()\n        # Read first line for title\n        with open(md_file, 'r', encoding='utf-8') as f:\n            first_line = f.readline().strip()\n            # Remove markdown heading prefix if present\n            title = first_line.lstrip('#').strip() or md_file.stem\n\n        documents.append({\n            'id': md_file.stem,\n            'filename': md_file.name,\n            'title': title,\n            'modified': stat.st_mtime,\n            'created': stat.st_ctime,\n        })\n\n    # Sort by modified time, newest first\n    documents.sort(key=lambda d: d['modified'], reverse=True)\n    return jsonify(documents)\n\n\n@app.route('/api/documents', methods=['POST'])\ndef create_document():\n    \"\"\"Create a new document.\"\"\"\n    data = request.get_json() or {}\n    content = data.get('content', '')", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "52", "text": "@app.route('/api/documents', methods=['POST'])\ndef create_document():\n    \"\"\"Create a new document.\"\"\"\n    data = request.get_json() or {}\n    content = data.get('content', '')\n\n    # Generate filename with timestamp and short UUID\n    timestamp = datetime.now().strftime('%Y%m%d-%H%M%S')\n    short_id = str(uuid.uuid4())[:8]\n    filename = f\"{timestamp}-{short_id}.md\"\n\n    filepath = REPO_PATH / filename\n\n    # Write content\n    with open(filepath, 'w', encoding='utf-8') as f:\n        f.write(content)\n\n    # Git commit\n    git_ops.commit_file(filename, \"Create new fragment\")\n\n    # Index the document (embedding generated on first search or rebuild)\n    stat = filepath.stat()\n    indexer.index_document(\n        doc_id=filepath.stem,\n        filename=filename,\n        content=content,\n        created_at=stat.st_ctime,\n        modified_at=stat.st_mtime,\n        generate_embedding=False  # Defer embedding generation\n    )\n\n    return jsonify({\n        'id': filepath.stem,\n        'filename': filename,\n        'title': content.split('\\n')[0].lstrip('#').strip() or filepath.stem,\n        'modified': stat.st_mtime,\n    }), 201\n\n\n@app.route('/api/documents/<doc_id>', methods=['GET'])\ndef get_document(doc_id):\n    \"\"\"Get a single document by ID.\"\"\"\n    filepath = REPO_PATH / f\"{doc_id}.md\"\n\n    if not filepath.exists():\n        return jsonify({'error': 'Document not found'}), 404\n\n    with open(filepath, 'r', encoding='utf-8') as f:\n        content = f.read()\n\n    stat = filepath.stat()\n    first_line = content.split('\\n')[0] if content else ''\n    title = first_line.lstrip('#').strip() or doc_id\n\n    # Get TODOs for this document\n    todos = indexer.get_todos_for_document(doc_id)\n\n    return jsonify({\n        'id': doc_id,\n        'filename': filepath.name,\n        'title': title,\n        'content': content,\n        'modified': stat.st_mtime,\n        'created': stat.st_ctime,\n        'todos': todos,\n    })", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "53", "text": "@app.route('/api/documents/<doc_id>', methods=['PUT'])\ndef update_document(doc_id):\n    \"\"\"Update a document's content.\"\"\"\n    filepath = REPO_PATH / f\"{doc_id}.md\"\n\n    if not filepath.exists():\n        return jsonify({'error': 'Document not found'}), 404\n\n    data = request.get_json()\n    if not data or 'content' not in data:\n        return jsonify({'error': 'Content required'}), 400\n\n    content = data['content']\n\n    # Write content\n    with open(filepath, 'w', encoding='utf-8') as f:\n        f.write(content)\n\n    # Git commit\n    git_ops.commit_file(filepath.name, \"Update fragment\")\n\n    # Re-index the document (embedding updated on next search or rebuild)\n    stat = filepath.stat()\n    indexer.index_document(\n        doc_id=doc_id,\n        filename=filepath.name,\n        content=content,\n        created_at=stat.st_ctime,\n        modified_at=stat.st_mtime,\n        generate_embedding=False  # Defer embedding generation\n    )\n\n    first_line = content.split('\\n')[0] if content else ''\n    title = first_line.lstrip('#').strip() or doc_id\n\n    return jsonify({\n        'id': doc_id,\n        'filename': filepath.name,\n        'title': title,\n        'content': content,\n        'modified': stat.st_mtime,\n    })\n\n\n@app.route('/api/documents/<doc_id>', methods=['DELETE'])\ndef delete_document(doc_id):\n    \"\"\"Delete a document.\"\"\"\n    filepath = REPO_PATH / f\"{doc_id}.md\"\n\n    if not filepath.exists():\n        return jsonify({'error': 'Document not found'}), 404\n\n    # Remove file and commit\n    filepath.unlink()\n    git_ops.commit_file(filepath.name, \"Delete fragment\", delete=True)\n\n    # Remove from index\n    indexer.remove_document(doc_id)\n\n    return jsonify({'success': True})\n\n\n# --- Search API ---\n\n@app.route('/api/search', methods=['GET'])\ndef search_documents():\n    \"\"\"Search documents using semantic search.\"\"\"\n    query = request.args.get('q', '').strip()\n    if not query:\n        return jsonify({'error': 'Query parameter q is required'}), 400", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "54", "text": "limit = request.args.get('limit', 10, type=int)\n\n    # Ensure embedding manager is initialized and connected to indexer\n    em = get_embedding_manager()\n    indexer.set_embedding_manager(em)\n\n    # Check if we have embeddings, if not trigger generation\n    stats = indexer.get_document_stats()\n    if stats['embeddings'] < stats['documents']:\n        # Generate missing embeddings\n        print(f\"Generating embeddings for {stats['documents'] - stats['embeddings']} documents...\")\n        indexer.rebuild_index(generate_embeddings=True)\n\n    results = indexer.search_documents(query, limit=limit)\n    return jsonify(results)\n\n\n# --- TODO API ---\n\n@app.route('/api/todos', methods=['GET'])\ndef list_todos():\n    \"\"\"List all TODOs across all documents.\"\"\"\n    include_done = request.args.get('include_done', 'false').lower() == 'true'\n    todos = indexer.get_all_todos(include_done=include_done)\n    return jsonify(todos)\n\n\n@app.route('/api/todos/stats', methods=['GET'])\ndef todo_stats():\n    \"\"\"Get TODO statistics.\"\"\"\n    stats = indexer.get_document_stats()\n    return jsonify(stats)\n\n\n# --- Questions API ---\n\n@app.route('/api/questions', methods=['GET'])\ndef list_questions():\n    \"\"\"List all unresolved questions.\"\"\"\n    include_resolved = request.args.get('include_resolved', 'false').lower() == 'true'\n    questions = indexer.get_all_questions(include_resolved=include_resolved)\n    return jsonify(questions)\n\n\n# --- Index API ---\n\n@app.route('/api/index/rebuild', methods=['POST'])\ndef rebuild_index():\n    \"\"\"Rebuild the entire index from the repository.\"\"\"\n    generate_embeddings = request.args.get('embeddings', 'true').lower() == 'true'\n\n    if generate_embeddings:\n        em = get_embedding_manager()\n        indexer.set_embedding_manager(em)\n\n    result = indexer.rebuild_index(generate_embeddings=generate_embeddings)\n    return jsonify(result)\n\n\n@app.route('/api/index/stats', methods=['GET'])\ndef index_stats():\n    \"\"\"Get index statistics.\"\"\"\n    stats = indexer.get_document_stats()\n    return jsonify(stats)\n\n\n# --- Consolidation API ---", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "55", "text": "@app.route('/api/index/stats', methods=['GET'])\ndef index_stats():\n    \"\"\"Get index statistics.\"\"\"\n    stats = indexer.get_document_stats()\n    return jsonify(stats)\n\n\n# --- Consolidation API ---\n\n@app.route('/api/consolidate', methods=['POST'])\ndef consolidate_document():\n    \"\"\"Start consolidation for one or more documents.\"\"\"\n    data = request.get_json()\n    if not data:\n        return jsonify({'error': 'Request body required'}), 400\n\n    # Support single document or multiple documents\n    doc_ids = data.get('document_ids', [])\n    doc_id = data.get('document_id')\n\n    if doc_id:\n        doc_ids = [doc_id]\n\n    if not doc_ids:\n        return jsonify({'error': 'document_id or document_ids required'}), 400\n\n    # Read document contents\n    documents = []\n    for did in doc_ids:\n        filepath = REPO_PATH / f\"{did}.md\"\n        if not filepath.exists():\n            return jsonify({'error': f'Document not found: {did}'}), 404\n        with open(filepath, 'r', encoding='utf-8') as f:\n            content = f.read()\n        documents.append((did, content))\n\n    try:\n        cm = get_consolidation_manager()\n\n        if len(documents) == 1:\n            result = cm.consolidate(documents[0][0], documents[0][1])\n        else:\n            result = cm.consolidate_multiple(documents)\n\n        diff = cm.generate_diff(result.original_content, result.consolidated_content)\n\n        return jsonify({\n            'branch_name': result.branch_name,\n            'document_id': result.document_id,\n            'created_at': result.created_at,\n            'diff': diff,\n        })\n\n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n\n@app.route('/api/consolidate/proposals', methods=['GET'])\ndef list_proposals():\n    \"\"\"List all active consolidation proposals.\"\"\"\n    cm = get_consolidation_manager()\n    proposals = cm.list_proposals()\n    return jsonify(proposals)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "56", "text": "@app.route('/api/consolidate/proposals/<branch_name>', methods=['GET'])\ndef get_proposal(branch_name):\n    \"\"\"Get a specific consolidation proposal.\"\"\"\n    cm = get_consolidation_manager()\n    proposal = cm.get_proposal(branch_name)\n\n    if not proposal:\n        return jsonify({'error': 'Proposal not found'}), 404\n\n    diff = cm.generate_diff(proposal.original_content, proposal.consolidated_content)\n\n    return jsonify({\n        'branch_name': proposal.branch_name,\n        'document_id': proposal.document_id,\n        'created_at': proposal.created_at,\n        'diff': diff,\n    })\n\n\n@app.route('/api/consolidate/proposals/<branch_name>/accept', methods=['POST'])\ndef accept_proposal(branch_name):\n    \"\"\"Accept a consolidation proposal and apply the changes.\"\"\"\n    cm = get_consolidation_manager()\n    proposal = cm.get_proposal(branch_name)\n\n    if not proposal:\n        return jsonify({'error': 'Proposal not found'}), 404\n\n    # Write the consolidated content back to the document\n    filepath = REPO_PATH / f\"{proposal.document_id}.md\"\n\n    # For merged documents, we might need to create a new file\n    if not filepath.exists():\n        # Create new merged document with timestamp\n        from datetime import datetime\n        import uuid as uuid_module\n        timestamp = datetime.now().strftime('%Y%m%d-%H%M%S')\n        short_id = str(uuid_module.uuid4())[:8]\n        filename = f\"{timestamp}-{short_id}.md\"\n        filepath = REPO_PATH / filename\n        doc_id = filepath.stem\n    else:\n        doc_id = proposal.document_id\n\n    # Write the consolidated content\n    with open(filepath, 'w', encoding='utf-8') as f:\n        f.write(proposal.consolidated_content)\n\n    # Git commit\n    git_ops.commit_file(filepath.name, f\"Consolidate document: {doc_id}\")\n\n    # Re-index the document\n    stat = filepath.stat()\n    indexer.index_document(\n        doc_id=doc_id,\n        filename=filepath.name,\n        content=proposal.consolidated_content,\n        created_at=stat.st_ctime,\n        modified_at=stat.st_mtime,\n        generate_embedding=False\n    )", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "57", "text": "# Remove from active proposals\n    cm.accept_proposal(branch_name)\n\n    return jsonify({\n        'success': True,\n        'document_id': doc_id,\n        'filename': filepath.name,\n    })\n\n\n@app.route('/api/consolidate/proposals/<branch_name>/reject', methods=['POST'])\ndef reject_proposal(branch_name):\n    \"\"\"Reject a consolidation proposal.\"\"\"\n    cm = get_consolidation_manager()\n\n    if not cm.reject_proposal(branch_name):\n        return jsonify({'error': 'Proposal not found'}), 404\n\n    return jsonify({'success': True})\n\n\n# --- Health check ---\n\n@app.route('/api/health', methods=['GET'])\ndef health_check():\n    \"\"\"Health check endpoint.\"\"\"\n    stats = indexer.get_document_stats()\n    return jsonify({\n        'status': 'ok',\n        'repo_initialized': git_ops.is_initialized(),\n        'index_stats': stats,\n    })\n\n\n# --- Main ---\n\ndef main():\n    \"\"\"Entry point for the Braindump server.\"\"\"\n    # Initialize git repo if needed\n    if not git_ops.is_initialized():\n        git_ops.initialize()\n        print(f\"Initialized git repository at {REPO_PATH}\")\n\n    # Rebuild index on startup (without embeddings for fast startup)\n    print(\"Rebuilding index...\")\n    result = indexer.rebuild_index(generate_embeddings=False)\n    print(f\"Index rebuilt: {result['documents_indexed']} documents, {result['todos_found']} TODOs\")\n    print(\"Note: Embeddings will be generated on first search\")\n\n    host = config['server'].get('host', '0.0.0.0')\n    port = config['server'].get('port', 3000)\n    debug = config['server'].get('debug', False)\n\n    print(f\"Starting Braindump server on http://{host}:{port}\")\n    app.run(host=host, port=port, debug=debug)\n\n\nif __name__ == '__main__':\n    main()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/app.py", "file_name": "app.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "58", "text": "\"\"\"\nBraindump Consolidation\n\nHandles AI-driven document consolidation: cleaning, organizing, and structuring notes.\n\"\"\"\n\nimport re\nimport time\nfrom typing import Optional\nfrom dataclasses import dataclass\n\n\n# System prompt for the consolidation AI\nCONSOLIDATION_SYSTEM_PROMPT = \"\"\"You are a personal knowledge librarian helping organize notes. Your job is to consolidate raw, unstructured notes into clean, well-organized documents.\n\nYour responsibilities:\n1. **Clean up formatting** - Fix typos, improve grammar, standardize formatting\n2. **Remove redundancy** - Merge duplicate information, eliminate repetition\n3. **Organize content** - Group related ideas, create logical sections\n4. **Identify uncertainties** - Mark unclear or contradictory statements with [QUESTION: ...]\n5. **Preserve meaning** - Never lose information or change the user's intent\n6. **Extract action items** - Ensure all TODOs/TASKs are preserved and visible\n\nOutput format:\n- Use Markdown formatting\n- Structure the document with clear headings\n- Preserve all TODO and TASK markers exactly as written\n- Insert [QUESTION: your question here] for anything unclear or needing clarification\n- Keep the tone consistent with the original notes\"\"\"\n\n\nCONSOLIDATION_USER_PROMPT = \"\"\"Please consolidate the following note(s) into a well-organized document.\n\nUse this structure when appropriate:\n# Title\n(A clear, descriptive title based on the content)\n\n## Summary\n(A brief 1-3 sentence summary of the main points)\n\n## Details\n(The organized content, with logical sections as needed)\n\n## Open Questions\n(Any [QUESTION: ...] blocks, either carried forward or newly identified)\n\n## TODOs\n(All TODO and TASK items extracted and listed)\n\n---\n\nCONTENT TO CONSOLIDATE:\n\n{content}\n\n---\n\nPlease provide the consolidated version. Preserve all task markers (TODO, TASK, DONE) exactly as they appear. If you identify anything unclear or contradictory, insert [QUESTION: your question] inline or in the Open Questions section.\"\"\"\n\n\n@dataclass\nclass ConsolidationResult:\n    \"\"\"Result of a consolidation operation.\"\"\"\n    original_content: str\n    consolidated_content: str\n    document_id: str\n    branch_name: str\n    created_at: float", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/consolidation.py", "file_name": "consolidation.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "59", "text": "@dataclass\nclass ConsolidationResult:\n    \"\"\"Result of a consolidation operation.\"\"\"\n    original_content: str\n    consolidated_content: str\n    document_id: str\n    branch_name: str\n    created_at: float\n\n\nclass ConsolidationManager:\n    \"\"\"Manages the consolidation process.\"\"\"\n\n    def __init__(self, llm_manager, git_ops):\n        self.llm = llm_manager\n        self.git = git_ops\n        self.active_proposals: dict[str, ConsolidationResult] = {}\n\n    def consolidate(self, document_id: str, content: str) -> ConsolidationResult:\n        \"\"\"\n        Consolidate a document using AI.\n\n        Args:\n            document_id: The ID of the document being consolidated\n            content: The raw content to consolidate\n\n        Returns:\n            ConsolidationResult with the proposed changes\n        \"\"\"\n        # Generate consolidated content via LLM\n        user_prompt = CONSOLIDATION_USER_PROMPT.format(content=content)\n        consolidated = self.llm.complete(\n            prompt=user_prompt,\n            system=CONSOLIDATION_SYSTEM_PROMPT,\n            max_tokens=8192\n        )\n\n        # Clean up the response (remove any markdown code blocks if present)\n        consolidated = self._clean_response(consolidated)\n\n        # Create a branch for the proposal\n        timestamp = int(time.time())\n        branch_name = f\"consolidate-{document_id[:8]}-{timestamp}\"\n\n        # Create the proposal\n        result = ConsolidationResult(\n            original_content=content,\n            consolidated_content=consolidated,\n            document_id=document_id,\n            branch_name=branch_name,\n            created_at=time.time()\n        )\n\n        # Store in active proposals\n        self.active_proposals[branch_name] = result\n\n        return result\n\n    def consolidate_multiple(self, documents: list[tuple[str, str]]) -> ConsolidationResult:\n        \"\"\"\n        Consolidate multiple documents into one.\n\n        Args:\n            documents: List of (document_id, content) tuples", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/consolidation.py", "file_name": "consolidation.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "60", "text": "def consolidate_multiple(self, documents: list[tuple[str, str]]) -> ConsolidationResult:\n        \"\"\"\n        Consolidate multiple documents into one.\n\n        Args:\n            documents: List of (document_id, content) tuples\n\n        Returns:\n            ConsolidationResult with the proposed merged content\n        \"\"\"\n        # Combine all documents with separators\n        combined_content = \"\"\n        doc_ids = []\n        for doc_id, content in documents:\n            doc_ids.append(doc_id)\n            combined_content += f\"--- Document: {doc_id} ---\\n\\n{content}\\n\\n\"\n\n        # Generate merged document ID\n        merged_id = \"-\".join([d[:4] for d in doc_ids[:3]])\n        if len(doc_ids) > 3:\n            merged_id += f\"-plus{len(doc_ids)-3}\"\n\n        return self.consolidate(merged_id, combined_content)\n\n    def _clean_response(self, response: str) -> str:\n        \"\"\"Clean up LLM response, removing wrapper code blocks if present.\"\"\"\n        # Remove markdown code block wrappers if the LLM added them\n        response = response.strip()\n        if response.startswith(\"```markdown\"):\n            response = response[11:]\n        elif response.startswith(\"```\"):\n            response = response[3:]\n        if response.endswith(\"```\"):\n            response = response[:-3]\n        return response.strip()\n\n    def get_proposal(self, branch_name: str) -> Optional[ConsolidationResult]:\n        \"\"\"Get an active proposal by branch name.\"\"\"\n        return self.active_proposals.get(branch_name)\n\n    def list_proposals(self) -> list[dict]:\n        \"\"\"List all active proposals.\"\"\"\n        return [\n            {\n                \"branch_name\": result.branch_name,\n                \"document_id\": result.document_id,\n                \"created_at\": result.created_at,\n            }\n            for result in self.active_proposals.values()\n        ]\n\n    def accept_proposal(self, branch_name: str) -> bool:\n        \"\"\"\n        Accept a consolidation proposal.\n\n        This writes the consolidated content back to the document.\n        \"\"\"\n        proposal = self.active_proposals.get(branch_name)\n        if not proposal:\n            return False\n\n        # Remove from active proposals\n        del self.active_proposals[branch_name]\n        return True", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/consolidation.py", "file_name": "consolidation.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "61", "text": "# Remove from active proposals\n        del self.active_proposals[branch_name]\n        return True\n\n    def reject_proposal(self, branch_name: str) -> bool:\n        \"\"\"\n        Reject a consolidation proposal.\n\n        This discards the proposed changes.\n        \"\"\"\n        if branch_name not in self.active_proposals:\n            return False\n\n        # Remove from active proposals\n        del self.active_proposals[branch_name]\n        return True\n\n    def generate_diff(self, original: str, consolidated: str) -> dict:\n        \"\"\"\n        Generate a simple diff representation for the UI.\n\n        Returns a dict with:\n        - original_lines: list of lines from original\n        - consolidated_lines: list of lines from consolidated\n        - changes: list of change operations for rendering\n        \"\"\"\n        original_lines = original.split('\\n')\n        consolidated_lines = consolidated.split('\\n')\n\n        # Simple diff: just return both versions for side-by-side display\n        # A more sophisticated diff could use difflib\n        return {\n            \"original\": original,\n            \"consolidated\": consolidated,\n            \"original_lines\": original_lines,\n            \"consolidated_lines\": consolidated_lines,\n            \"original_line_count\": len(original_lines),\n            \"consolidated_line_count\": len(consolidated_lines),\n        }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/consolidation.py", "file_name": "consolidation.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "62", "text": "\"\"\"\nBraindump Embeddings\n\nHandles embedding generation for semantic search.\nSupports local models (sentence-transformers) and can be extended for API-based embeddings.\n\"\"\"\n\nimport hashlib\nimport numpy as np\nfrom typing import Optional\nfrom pathlib import Path\n\n\nclass EmbeddingProvider:\n    \"\"\"Base class for embedding providers.\"\"\"\n\n    def __init__(self, model_name: str):\n        self.model_name = model_name\n        self.dimension = 0\n\n    def embed(self, text: str) -> list[float]:\n        raise NotImplementedError\n\n    def embed_batch(self, texts: list[str]) -> list[list[float]]:\n        return [self.embed(text) for text in texts]\n\n\nclass LocalEmbeddings(EmbeddingProvider):\n    \"\"\"Local embeddings using sentence-transformers.\"\"\"\n\n    def __init__(self, model_name: str = 'all-MiniLM-L6-v2'):\n        super().__init__(model_name)\n        self.model = None\n        self._load_model()\n\n    def _load_model(self):\n        try:\n            from sentence_transformers import SentenceTransformer\n            print(f\"Loading embedding model: {self.model_name}\")\n            self.model = SentenceTransformer(self.model_name)\n            # Get embedding dimension from a test embedding\n            test_embedding = self.model.encode(\"test\", convert_to_numpy=True)\n            self.dimension = len(test_embedding)\n            print(f\"Embedding model loaded. Dimension: {self.dimension}\")\n        except ImportError:\n            raise ImportError(\"sentence-transformers is required for local embeddings\")\n\n    def embed(self, text: str) -> list[float]:\n        if not self.model:\n            raise RuntimeError(\"Model not loaded\")\n        embedding = self.model.encode(text, convert_to_numpy=True)\n        return embedding.tolist()\n\n    def embed_batch(self, texts: list[str]) -> list[list[float]]:\n        if not self.model:\n            raise RuntimeError(\"Model not loaded\")\n        embeddings = self.model.encode(texts, convert_to_numpy=True)\n        return [e.tolist() for e in embeddings]\n\n\nclass EmbeddingManager:\n    \"\"\"Manages embedding generation and caching.\"\"\"\n\n    def __init__(self, config: dict):\n        self.config = config\n        self.provider = None\n        self._init_provider()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/embeddings.py", "file_name": "embeddings.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "63", "text": "class EmbeddingManager:\n    \"\"\"Manages embedding generation and caching.\"\"\"\n\n    def __init__(self, config: dict):\n        self.config = config\n        self.provider = None\n        self._init_provider()\n\n    def _init_provider(self):\n        provider_type = self.config.get('provider', 'local')\n        model_name = self.config.get('model', 'all-MiniLM-L6-v2')\n\n        if provider_type == 'local':\n            self.provider = LocalEmbeddings(model_name)\n        else:\n            # Could add API-based providers here (OpenAI, etc.)\n            raise ValueError(f\"Unknown embedding provider: {provider_type}\")\n\n    @property\n    def dimension(self) -> int:\n        return self.provider.dimension if self.provider else 0\n\n    def get_embedding(self, text: str) -> list[float]:\n        \"\"\"Generate embedding for a single text.\"\"\"\n        if not self.provider:\n            raise RuntimeError(\"No embedding provider configured\")\n        return self.provider.embed(text)\n\n    def get_embeddings(self, texts: list[str]) -> list[list[float]]:\n        \"\"\"Generate embeddings for multiple texts.\"\"\"\n        if not self.provider:\n            raise RuntimeError(\"No embedding provider configured\")\n        return self.provider.embed_batch(texts)\n\n    @staticmethod\n    def content_hash(content: str) -> str:\n        \"\"\"Generate a hash of content for caching.\"\"\"\n        return hashlib.md5(content.encode()).hexdigest()\n\n    @staticmethod\n    def cosine_similarity(a: list[float], b: list[float]) -> float:\n        \"\"\"Calculate cosine similarity between two vectors.\"\"\"\n        a = np.array(a)\n        b = np.array(b)\n        return float(np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b)))\n\n    def search(self, query: str, embeddings: list[tuple[str, list[float]]], top_k: int = 10) -> list[tuple[str, float]]:\n        \"\"\"\n        Search for similar documents.\n\n        Args:\n            query: The search query\n            embeddings: List of (doc_id, embedding) tuples\n            top_k: Number of results to return\n\n        Returns:\n            List of (doc_id, similarity_score) tuples, sorted by similarity\n        \"\"\"\n        query_embedding = self.get_embedding(query)", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/embeddings.py", "file_name": "embeddings.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "64", "text": "Returns:\n            List of (doc_id, similarity_score) tuples, sorted by similarity\n        \"\"\"\n        query_embedding = self.get_embedding(query)\n\n        results = []\n        for doc_id, doc_embedding in embeddings:\n            similarity = self.cosine_similarity(query_embedding, doc_embedding)\n            results.append((doc_id, similarity))\n\n        # Sort by similarity (highest first)\n        results.sort(key=lambda x: x[1], reverse=True)\n\n        return results[:top_k]", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/embeddings.py", "file_name": "embeddings.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "65", "text": "\"\"\"\nGit operations for Braindump.\n\nHandles repository initialization, commits, and branching for the notes storage.\n\"\"\"\n\nfrom pathlib import Path\nfrom git import Repo, InvalidGitRepositoryError\nfrom git.exc import GitCommandError\n\n\nclass GitOps:\n    \"\"\"Manages git operations for the notes repository.\"\"\"\n\n    def __init__(self, repo_path: Path):\n        self.repo_path = Path(repo_path)\n        self.repo = None\n        self._load_repo()\n\n    def _load_repo(self):\n        \"\"\"Load existing repo or prepare for initialization.\"\"\"\n        if self.repo_path.exists():\n            try:\n                self.repo = Repo(self.repo_path)\n            except InvalidGitRepositoryError:\n                self.repo = None\n\n    def is_initialized(self) -> bool:\n        \"\"\"Check if the repository is initialized.\"\"\"\n        return self.repo is not None\n\n    def initialize(self) -> bool:\n        \"\"\"Initialize a new git repository.\"\"\"\n        self.repo_path.mkdir(parents=True, exist_ok=True)\n        self.repo = Repo.init(self.repo_path)\n\n        # Create initial .gitignore\n        gitignore_path = self.repo_path / '.gitignore'\n        gitignore_path.write_text('# Braindump notes repository\\n.DS_Store\\n')\n\n        # Initial commit\n        self.repo.index.add(['.gitignore'])\n        self.repo.index.commit('Initialize notes repository')\n\n        return True\n\n    def commit_file(self, filename: str, message: str, delete: bool = False):\n        \"\"\"Commit a single file change.\"\"\"\n        if not self.repo:\n            return False\n\n        try:\n            if delete:\n                # Stage deletion\n                self.repo.index.remove([filename])\n            else:\n                # Stage addition/modification\n                self.repo.index.add([filename])\n\n            self.repo.index.commit(message)\n            return True\n        except GitCommandError as e:\n            print(f\"Git commit error: {e}\")\n            return False\n\n    def get_file_history(self, filename: str, limit: int = 10) -> list:\n        \"\"\"Get commit history for a specific file.\"\"\"\n        if not self.repo:\n            return []", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/git_ops.py", "file_name": "git_ops.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "66", "text": "def get_file_history(self, filename: str, limit: int = 10) -> list:\n        \"\"\"Get commit history for a specific file.\"\"\"\n        if not self.repo:\n            return []\n\n        try:\n            commits = list(self.repo.iter_commits(paths=filename, max_count=limit))\n            return [\n                {\n                    'sha': c.hexsha[:8],\n                    'message': c.message.strip(),\n                    'date': c.committed_datetime.isoformat(),\n                    'author': str(c.author),\n                }\n                for c in commits\n            ]\n        except GitCommandError:\n            return []\n\n    def create_branch(self, branch_name: str) -> bool:\n        \"\"\"Create a new branch from current HEAD.\"\"\"\n        if not self.repo:\n            return False\n\n        try:\n            self.repo.create_head(branch_name)\n            return True\n        except GitCommandError:\n            return False\n\n    def checkout_branch(self, branch_name: str) -> bool:\n        \"\"\"Checkout an existing branch.\"\"\"\n        if not self.repo:\n            return False\n\n        try:\n            self.repo.heads[branch_name].checkout()\n            return True\n        except (GitCommandError, IndexError):\n            return False\n\n    def get_current_branch(self) -> str:\n        \"\"\"Get the name of the current branch.\"\"\"\n        if not self.repo:\n            return ''\n        return self.repo.active_branch.name\n\n    def merge_branch(self, branch_name: str) -> bool:\n        \"\"\"Merge a branch into current branch.\"\"\"\n        if not self.repo:\n            return False\n\n        try:\n            self.repo.git.merge(branch_name)\n            return True\n        except GitCommandError:\n            return False\n\n    def delete_branch(self, branch_name: str) -> bool:\n        \"\"\"Delete a branch.\"\"\"\n        if not self.repo:\n            return False\n\n        try:\n            self.repo.delete_head(branch_name, force=True)\n            return True\n        except GitCommandError:\n            return False\n\n    def get_diff(self, branch_name: str) -> str:\n        \"\"\"Get diff between current branch and another branch.\"\"\"\n        if not self.repo:\n            return ''\n\n        try:\n            return self.repo.git.diff(f'HEAD..{branch_name}')\n        except GitCommandError:\n            return ''", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/git_ops.py", "file_name": "git_ops.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "67", "text": "try:\n            return self.repo.git.diff(f'HEAD..{branch_name}')\n        except GitCommandError:\n            return ''\n\n    def get_recent_activity(self, hours: int = 24) -> list:\n        \"\"\"Get files modified in the last N hours.\"\"\"\n        if not self.repo:\n            return []\n\n        from datetime import datetime, timedelta\n        cutoff = datetime.now() - timedelta(hours=hours)\n\n        try:\n            commits = list(self.repo.iter_commits(since=cutoff.isoformat()))\n            files = set()\n            for commit in commits:\n                files.update(commit.stats.files.keys())\n            return list(files)\n        except GitCommandError:\n            return []", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/git_ops.py", "file_name": "git_ops.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "68", "text": "\"\"\"\nBraindump Indexer\n\nSQLite-based index for fast queries, TODO extraction, and semantic search.\nThe index is derived from the git repository and can be rebuilt at any time.\n\"\"\"\n\nimport sqlite3\nimport json\nimport re\nfrom pathlib import Path\nfrom datetime import datetime\nfrom typing import Optional\n\n\nclass Indexer:\n    \"\"\"Manages the SQLite index for documents and TODOs.\"\"\"\n\n    # Patterns for TODO detection\n    TODO_PATTERN = re.compile(\n        r'^(.*?)\\b(TODO|TASK)\\b[:\\s]*(.*)$',\n        re.IGNORECASE\n    )\n    DONE_PATTERN = re.compile(r'\\bDONE\\b', re.IGNORECASE)\n    QUESTION_PATTERN = re.compile(r'\\[QUESTION:\\s*([^\\]]+)\\]', re.IGNORECASE)\n\n    def __init__(self, db_path: Path, repo_path: Path, embedding_manager=None):\n        self.db_path = Path(db_path)\n        self.repo_path = Path(repo_path)\n        self.embedding_manager = embedding_manager\n        self.conn = None\n        self._init_db()\n\n    def _init_db(self):\n        \"\"\"Initialize the database schema.\"\"\"\n        self.db_path.parent.mkdir(parents=True, exist_ok=True)\n        self.conn = sqlite3.connect(self.db_path, check_same_thread=False)\n        self.conn.row_factory = sqlite3.Row\n\n        self.conn.executescript('''\n            CREATE TABLE IF NOT EXISTS documents (\n                id TEXT PRIMARY KEY,\n                filename TEXT NOT NULL,\n                title TEXT,\n                content_hash TEXT,\n                created_at REAL,\n                modified_at REAL,\n                indexed_at REAL\n            );\n\n            CREATE TABLE IF NOT EXISTS todos (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                document_id TEXT NOT NULL,\n                line_number INTEGER NOT NULL,\n                todo_type TEXT NOT NULL,\n                text TEXT NOT NULL,\n                is_done INTEGER DEFAULT 0,\n                created_at REAL,\n                FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,\n                UNIQUE(document_id, line_number)\n            );", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "69", "text": "CREATE TABLE IF NOT EXISTS questions (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                document_id TEXT NOT NULL,\n                line_number INTEGER NOT NULL,\n                text TEXT NOT NULL,\n                is_resolved INTEGER DEFAULT 0,\n                created_at REAL,\n                FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE\n            );\n\n            CREATE TABLE IF NOT EXISTS embeddings (\n                document_id TEXT PRIMARY KEY,\n                content_hash TEXT NOT NULL,\n                embedding TEXT NOT NULL,\n                created_at REAL,\n                FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE\n            );\n\n            CREATE INDEX IF NOT EXISTS idx_todos_document ON todos(document_id);\n            CREATE INDEX IF NOT EXISTS idx_todos_done ON todos(is_done);\n            CREATE INDEX IF NOT EXISTS idx_questions_document ON questions(document_id);\n            CREATE INDEX IF NOT EXISTS idx_embeddings_hash ON embeddings(content_hash);\n        ''')\n        self.conn.commit()\n\n    def set_embedding_manager(self, embedding_manager):\n        \"\"\"Set the embedding manager after initialization.\"\"\"\n        self.embedding_manager = embedding_manager\n\n    def index_document(self, doc_id: str, filename: str, content: str,\n                       created_at: float, modified_at: float,\n                       generate_embedding: bool = True) -> dict:\n        \"\"\"Index a single document, extracting TODOs and questions.\"\"\"\n        import hashlib\n        content_hash = hashlib.md5(content.encode()).hexdigest()\n\n        # Check if content has changed\n        existing = self.conn.execute(\n            'SELECT content_hash FROM documents WHERE id = ?', (doc_id,)\n        ).fetchone()\n\n        if existing and existing['content_hash'] == content_hash:\n            # Content unchanged, skip re-indexing\n            return {'status': 'unchanged', 'doc_id': doc_id}\n\n        # Extract title from first line\n        lines = content.split('\\n')\n        title = lines[0].lstrip('#').strip() if lines else filename", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "70", "text": "# Extract title from first line\n        lines = content.split('\\n')\n        title = lines[0].lstrip('#').strip() if lines else filename\n\n        # Update or insert document\n        now = datetime.now().timestamp()\n        self.conn.execute('''\n            INSERT INTO documents (id, filename, title, content_hash, created_at, modified_at, indexed_at)\n            VALUES (?, ?, ?, ?, ?, ?, ?)\n            ON CONFLICT(id) DO UPDATE SET\n                filename = excluded.filename,\n                title = excluded.title,\n                content_hash = excluded.content_hash,\n                modified_at = excluded.modified_at,\n                indexed_at = excluded.indexed_at\n        ''', (doc_id, filename, title, content_hash, created_at, modified_at, now))\n\n        # Clear existing TODOs and questions for this document\n        self.conn.execute('DELETE FROM todos WHERE document_id = ?', (doc_id,))\n        self.conn.execute('DELETE FROM questions WHERE document_id = ?', (doc_id,))\n\n        # Extract TODOs\n        todos_found = 0\n        for line_num, line in enumerate(lines, start=1):\n            todo_match = self.TODO_PATTERN.search(line)\n            if todo_match:\n                is_done = 1 if self.DONE_PATTERN.search(line) else 0\n                prefix = todo_match.group(1).strip()\n                todo_type = todo_match.group(2).upper()\n                todo_text = todo_match.group(3).strip()\n\n                # Combine prefix context if meaningful\n                full_text = todo_text if not prefix or prefix in ['-', '*', '•'] else f\"{prefix}: {todo_text}\"\n                if not full_text:\n                    full_text = line.strip()\n\n                self.conn.execute('''\n                    INSERT INTO todos (document_id, line_number, todo_type, text, is_done, created_at)\n                    VALUES (?, ?, ?, ?, ?, ?)\n                ''', (doc_id, line_num, todo_type, full_text, is_done, now))\n                todos_found += 1", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "71", "text": "# Extract questions\n            for q_match in self.QUESTION_PATTERN.finditer(line):\n                self.conn.execute('''\n                    INSERT INTO questions (document_id, line_number, text, created_at)\n                    VALUES (?, ?, ?, ?)\n                ''', (doc_id, line_num, q_match.group(1).strip(), now))\n\n        self.conn.commit()\n\n        # Generate embedding if manager is available\n        embedding_generated = False\n        if generate_embedding and self.embedding_manager and content.strip():\n            embedding_generated = self._update_embedding(doc_id, content, content_hash)\n\n        return {\n            'status': 'indexed',\n            'doc_id': doc_id,\n            'todos_found': todos_found,\n            'embedding_generated': embedding_generated\n        }\n\n    def _update_embedding(self, doc_id: str, content: str, content_hash: str) -> bool:\n        \"\"\"Generate and store embedding for a document.\"\"\"\n        # Check if we already have an embedding for this content hash\n        existing = self.conn.execute(\n            'SELECT content_hash FROM embeddings WHERE document_id = ?', (doc_id,)\n        ).fetchone()\n\n        if existing and existing['content_hash'] == content_hash:\n            return False  # Embedding already exists for this content\n\n        try:\n            embedding = self.embedding_manager.get_embedding(content)\n            now = datetime.now().timestamp()\n\n            self.conn.execute('''\n                INSERT INTO embeddings (document_id, content_hash, embedding, created_at)\n                VALUES (?, ?, ?, ?)\n                ON CONFLICT(document_id) DO UPDATE SET\n                    content_hash = excluded.content_hash,\n                    embedding = excluded.embedding,\n                    created_at = excluded.created_at\n            ''', (doc_id, content_hash, json.dumps(embedding), now))\n            self.conn.commit()\n            return True\n        except Exception as e:\n            print(f\"Error generating embedding for {doc_id}: {e}\")\n            return False\n\n    def remove_document(self, doc_id: str):\n        \"\"\"Remove a document and its TODOs from the index.\"\"\"\n        self.conn.execute('DELETE FROM documents WHERE id = ?', (doc_id,))\n        self.conn.execute('DELETE FROM embeddings WHERE document_id = ?', (doc_id,))\n        # TODOs and questions are cascade deleted\n        self.conn.commit()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "72", "text": "def get_all_todos(self, include_done: bool = False) -> list:\n        \"\"\"Get all TODOs across all documents.\"\"\"\n        query = '''\n            SELECT t.*, d.title as document_title, d.filename\n            FROM todos t\n            JOIN documents d ON t.document_id = d.id\n        '''\n        if not include_done:\n            query += ' WHERE t.is_done = 0'\n        query += ' ORDER BY t.created_at DESC'\n\n        rows = self.conn.execute(query).fetchall()\n        return [dict(row) for row in rows]\n\n    def get_todos_for_document(self, doc_id: str) -> list:\n        \"\"\"Get TODOs for a specific document.\"\"\"\n        rows = self.conn.execute('''\n            SELECT * FROM todos WHERE document_id = ? ORDER BY line_number\n        ''', (doc_id,)).fetchall()\n        return [dict(row) for row in rows]\n\n    def get_all_questions(self, include_resolved: bool = False) -> list:\n        \"\"\"Get all unresolved questions.\"\"\"\n        query = '''\n            SELECT q.*, d.title as document_title, d.filename\n            FROM questions q\n            JOIN documents d ON q.document_id = d.id\n        '''\n        if not include_resolved:\n            query += ' WHERE q.is_resolved = 0'\n        query += ' ORDER BY q.created_at DESC'\n\n        rows = self.conn.execute(query).fetchall()\n        return [dict(row) for row in rows]\n\n    def get_document_stats(self) -> dict:\n        \"\"\"Get statistics about indexed documents.\"\"\"\n        doc_count = self.conn.execute('SELECT COUNT(*) FROM documents').fetchone()[0]\n        todo_count = self.conn.execute('SELECT COUNT(*) FROM todos WHERE is_done = 0').fetchone()[0]\n        done_count = self.conn.execute('SELECT COUNT(*) FROM todos WHERE is_done = 1').fetchone()[0]\n        question_count = self.conn.execute('SELECT COUNT(*) FROM questions WHERE is_resolved = 0').fetchone()[0]\n        embedding_count = self.conn.execute('SELECT COUNT(*) FROM embeddings').fetchone()[0]", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "73", "text": "return {\n            'documents': doc_count,\n            'open_todos': todo_count,\n            'completed_todos': done_count,\n            'open_questions': question_count,\n            'embeddings': embedding_count,\n        }\n\n    def get_all_embeddings(self) -> list[tuple[str, list[float]]]:\n        \"\"\"Get all embeddings for search.\"\"\"\n        rows = self.conn.execute('''\n            SELECT document_id, embedding FROM embeddings\n        ''').fetchall()\n        return [(row['document_id'], json.loads(row['embedding'])) for row in rows]\n\n    def semantic_search(self, query: str, limit: int = 10) -> list:\n        \"\"\"Perform semantic search using embeddings.\"\"\"\n        if not self.embedding_manager:\n            return []\n\n        embeddings = self.get_all_embeddings()\n        if not embeddings:\n            return []\n\n        # Get search results\n        results = self.embedding_manager.search(query, embeddings, top_k=limit)\n\n        # Fetch document details for results\n        search_results = []\n        for doc_id, score in results:\n            doc = self.conn.execute('''\n                SELECT id, filename, title, modified_at FROM documents WHERE id = ?\n            ''', (doc_id,)).fetchone()\n            if doc:\n                result = dict(doc)\n                result['score'] = score\n                # Get a snippet of content\n                filepath = self.repo_path / f\"{doc_id}.md\"\n                if filepath.exists():\n                    with open(filepath, 'r', encoding='utf-8') as f:\n                        content = f.read()\n                        # Get first 200 chars as snippet\n                        result['snippet'] = content[:200].replace('\\n', ' ').strip()\n                        if len(content) > 200:\n                            result['snippet'] += '...'\n                search_results.append(result)\n\n        return search_results\n\n    def rebuild_index(self, generate_embeddings: bool = True) -> dict:\n        \"\"\"Rebuild the entire index from the repository.\"\"\"\n        if not self.repo_path.exists():\n            return {'status': 'error', 'message': 'Repository path does not exist'}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "74", "text": "# Clear all data\n        self.conn.execute('DELETE FROM todos')\n        self.conn.execute('DELETE FROM questions')\n        self.conn.execute('DELETE FROM embeddings')\n        self.conn.execute('DELETE FROM documents')\n        self.conn.commit()\n\n        indexed = 0\n        total_todos = 0\n        embeddings_generated = 0\n\n        for md_file in self.repo_path.glob('*.md'):\n            stat = md_file.stat()\n            with open(md_file, 'r', encoding='utf-8') as f:\n                content = f.read()\n\n            result = self.index_document(\n                doc_id=md_file.stem,\n                filename=md_file.name,\n                content=content,\n                created_at=stat.st_ctime,\n                modified_at=stat.st_mtime,\n                generate_embedding=generate_embeddings\n            )\n            indexed += 1\n            total_todos += result.get('todos_found', 0)\n            if result.get('embedding_generated'):\n                embeddings_generated += 1\n\n        return {\n            'status': 'success',\n            'documents_indexed': indexed,\n            'todos_found': total_todos,\n            'embeddings_generated': embeddings_generated,\n        }\n\n    def search_documents(self, query: str, limit: int = 20) -> list:\n        \"\"\"Search documents - uses semantic search if available, falls back to text search.\"\"\"\n        # Try semantic search first\n        if self.embedding_manager:\n            results = self.semantic_search(query, limit)\n            if results:\n                return results\n\n        # Fallback to simple text search\n        rows = self.conn.execute('''\n            SELECT id, filename, title, modified_at\n            FROM documents\n            WHERE title LIKE ? OR filename LIKE ?\n            ORDER BY modified_at DESC\n            LIMIT ?\n        ''', (f'%{query}%', f'%{query}%', limit)).fetchall()\n\n        return [dict(row) for row in rows]\n\n    def close(self):\n        \"\"\"Close the database connection.\"\"\"\n        if self.conn:\n            self.conn.close()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/indexer.py", "file_name": "indexer.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "75", "text": "\"\"\"\nBraindump LLM Integration\n\nHandles LLM calls for document consolidation.\nSupports multiple providers: OpenRouter (default), Anthropic (future).\n\"\"\"\n\nimport os\nimport json\nimport httpx\nfrom typing import Optional\nfrom abc import ABC, abstractmethod\n\n\nclass LLMProvider(ABC):\n    \"\"\"Base class for LLM providers.\"\"\"\n\n    def __init__(self, model: str, api_key: str):\n        self.model = model\n        self.api_key = api_key\n\n    @abstractmethod\n    def complete(self, prompt: str, system: Optional[str] = None, max_tokens: int = 4096) -> str:\n        \"\"\"Generate a completion for the given prompt.\"\"\"\n        pass\n\n\nclass OpenRouterProvider(LLMProvider):\n    \"\"\"OpenRouter API provider (OpenAI-compatible API).\"\"\"\n\n    BASE_URL = \"https://openrouter.ai/api/v1/chat/completions\"\n\n    def __init__(self, model: str, api_key: str, site_url: str = \"\", site_name: str = \"Braindump\"):\n        super().__init__(model, api_key)\n        self.site_url = site_url\n        self.site_name = site_name\n\n    def complete(self, prompt: str, system: Optional[str] = None, max_tokens: int = 4096) -> str:\n        \"\"\"Generate a completion using OpenRouter API.\"\"\"\n        messages = []\n\n        if system:\n            messages.append({\"role\": \"system\", \"content\": system})\n\n        messages.append({\"role\": \"user\", \"content\": prompt})\n\n        headers = {\n            \"Authorization\": f\"Bearer {self.api_key}\",\n            \"Content-Type\": \"application/json\",\n            \"HTTP-Referer\": self.site_url,\n            \"X-Title\": self.site_name,\n        }\n\n        payload = {\n            \"model\": self.model,\n            \"messages\": messages,\n            \"max_tokens\": max_tokens,\n        }\n\n        try:\n            with httpx.Client(timeout=120.0) as client:\n                response = client.post(self.BASE_URL, headers=headers, json=payload)\n                response.raise_for_status()\n                data = response.json()", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/llm.py", "file_name": "llm.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "76", "text": "try:\n            with httpx.Client(timeout=120.0) as client:\n                response = client.post(self.BASE_URL, headers=headers, json=payload)\n                response.raise_for_status()\n                data = response.json()\n\n                # Extract the response content\n                if \"choices\" in data and len(data[\"choices\"]) > 0:\n                    return data[\"choices\"][0][\"message\"][\"content\"]\n                else:\n                    raise ValueError(f\"Unexpected response format: {data}\")\n\n        except httpx.HTTPStatusError as e:\n            raise RuntimeError(f\"OpenRouter API error: {e.response.status_code} - {e.response.text}\")\n        except httpx.RequestError as e:\n            raise RuntimeError(f\"OpenRouter request failed: {str(e)}\")\n\n\nclass AnthropicProvider(LLMProvider):\n    \"\"\"Anthropic Claude API provider.\"\"\"\n\n    BASE_URL = \"https://api.anthropic.com/v1/messages\"\n\n    def __init__(self, model: str, api_key: str):\n        super().__init__(model, api_key)\n\n    def complete(self, prompt: str, system: Optional[str] = None, max_tokens: int = 4096) -> str:\n        \"\"\"Generate a completion using Anthropic API.\"\"\"\n        headers = {\n            \"x-api-key\": self.api_key,\n            \"Content-Type\": \"application/json\",\n            \"anthropic-version\": \"2023-06-01\",\n        }\n\n        payload = {\n            \"model\": self.model,\n            \"max_tokens\": max_tokens,\n            \"messages\": [{\"role\": \"user\", \"content\": prompt}],\n        }\n\n        if system:\n            payload[\"system\"] = system\n\n        try:\n            with httpx.Client(timeout=120.0) as client:\n                response = client.post(self.BASE_URL, headers=headers, json=payload)\n                response.raise_for_status()\n                data = response.json()\n\n                # Extract the response content\n                if \"content\" in data and len(data[\"content\"]) > 0:\n                    return data[\"content\"][0][\"text\"]\n                else:\n                    raise ValueError(f\"Unexpected response format: {data}\")", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/llm.py", "file_name": "llm.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "77", "text": "# Extract the response content\n                if \"content\" in data and len(data[\"content\"]) > 0:\n                    return data[\"content\"][0][\"text\"]\n                else:\n                    raise ValueError(f\"Unexpected response format: {data}\")\n\n        except httpx.HTTPStatusError as e:\n            raise RuntimeError(f\"Anthropic API error: {e.response.status_code} - {e.response.text}\")\n        except httpx.RequestError as e:\n            raise RuntimeError(f\"Anthropic request failed: {str(e)}\")\n\n\ndef resolve_env_var(value: str) -> str:\n    \"\"\"Resolve environment variable references like ${VAR_NAME}.\"\"\"\n    if isinstance(value, str) and value.startswith(\"${\") and value.endswith(\"}\"):\n        env_var = value[2:-1]\n        resolved = os.environ.get(env_var, \"\")\n        if not resolved:\n            print(f\"Warning: Environment variable {env_var} not set\")\n        return resolved\n    return value\n\n\nclass LLMManager:\n    \"\"\"Manages LLM provider initialization and API calls.\"\"\"\n\n    def __init__(self, config: dict):\n        self.config = config\n        self.provider: Optional[LLMProvider] = None\n        self._init_provider()\n\n    def _init_provider(self):\n        provider_type = self.config.get(\"provider\", \"openrouter\")\n        model = self.config.get(\"model\", \"anthropic/claude-3.5-sonnet\")\n        api_key = resolve_env_var(self.config.get(\"api_key\", \"\"))\n\n        if not api_key:\n            raise ValueError(f\"No API key configured for LLM provider: {provider_type}\")\n\n        if provider_type == \"openrouter\":\n            site_url = self.config.get(\"site_url\", \"\")\n            site_name = self.config.get(\"site_name\", \"Braindump\")\n            self.provider = OpenRouterProvider(model, api_key, site_url, site_name)\n            print(f\"LLM provider initialized: OpenRouter ({model})\")\n\n        elif provider_type == \"anthropic\":\n            self.provider = AnthropicProvider(model, api_key)\n            print(f\"LLM provider initialized: Anthropic ({model})\")\n\n        else:\n            raise ValueError(f\"Unknown LLM provider: {provider_type}\")", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/llm.py", "file_name": "llm.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "78", "text": "else:\n            raise ValueError(f\"Unknown LLM provider: {provider_type}\")\n\n    def complete(self, prompt: str, system: Optional[str] = None, max_tokens: int = 4096) -> str:\n        \"\"\"Generate a completion.\"\"\"\n        if not self.provider:\n            raise RuntimeError(\"No LLM provider configured\")\n        return self.provider.complete(prompt, system, max_tokens)\n\n    @property\n    def model(self) -> str:\n        \"\"\"Get the current model name.\"\"\"\n        return self.provider.model if self.provider else \"\"\n\n    @property\n    def is_initialized(self) -> bool:\n        \"\"\"Check if provider is initialized.\"\"\"\n        return self.provider is not None", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/llm.py", "file_name": "llm.py", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "79", "text": "flask>=3.0.0\ngitpython>=3.1.40\npython-dotenv>=1.0.0\nanthropic>=0.39.0\nsentence-transformers>=2.2.0", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/server/requirements.txt", "file_name": "requirements.txt", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "80", "text": "/* Braindump Styles */\n\n:root {\n    --bg-primary: #1a1a2e;\n    --bg-secondary: #16213e;\n    --bg-tertiary: #0f0f1a;\n    --text-primary: #e4e4e7;\n    --text-secondary: #a1a1aa;\n    --text-muted: #71717a;\n    --accent: #6366f1;\n    --accent-hover: #818cf8;\n    --border: #27273a;\n    --success: #22c55e;\n    --warning: #f59e0b;\n    --error: #ef4444;\n\n    --sidebar-width: 280px;\n    --topbar-height: 56px;\n    --radius: 6px;\n    --transition: 150ms ease;\n}\n\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nhtml, body {\n    height: 100%;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    background: var(--bg-primary);\n    color: var(--text-primary);\n}\n\n#app {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n}\n\n/* Top Bar */\n.top-bar {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: var(--topbar-height);\n    padding: 0 16px;\n    background: var(--bg-secondary);\n    border-bottom: 1px solid var(--border);\n    gap: 16px;\n}\n\n.top-bar-left {\n    display: flex;\n    align-items: center;\n}\n\n.logo {\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.top-bar-center {\n    flex: 1;\n    max-width: 400px;\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "81", "text": ".logo {\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.top-bar-center {\n    flex: 1;\n    max-width: 400px;\n}\n\n#search-input {\n    width: 100%;\n    padding: 8px 12px;\n    background: var(--bg-tertiary);\n    border: 1px solid var(--border);\n    border-radius: var(--radius);\n    color: var(--text-primary);\n    font-size: 14px;\n    transition: border-color var(--transition);\n}\n\n#search-input:focus {\n    outline: none;\n    border-color: var(--accent);\n}\n\n#search-input:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.top-bar-right {\n    display: flex;\n    gap: 8px;\n}\n\n/* Buttons */\n.btn {\n    padding: 8px 16px;\n    background: var(--bg-tertiary);\n    border: 1px solid var(--border);\n    border-radius: var(--radius);\n    color: var(--text-primary);\n    font-size: 14px;\n    cursor: pointer;\n    transition: all var(--transition);\n}\n\n.btn:hover:not(:disabled) {\n    background: var(--border);\n}\n\n.btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.btn-primary {\n    background: var(--accent);\n    border-color: var(--accent);\n    color: white;\n}\n\n.btn-primary:hover:not(:disabled) {\n    background: var(--accent-hover);\n    border-color: var(--accent-hover);\n}\n\n.btn-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 32px;\n    height: 32px;\n    padding: 0;\n    background: transparent;\n    border: none;\n    border-radius: var(--radius);\n    color: var(--text-secondary);\n    cursor: pointer;\n    transition: all var(--transition);\n}\n\n.btn-icon:hover {\n    background: var(--border);\n    color: var(--text-primary);\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "82", "text": ".btn-icon:hover {\n    background: var(--border);\n    color: var(--text-primary);\n}\n\n/* Main Content */\n.main-content {\n    display: flex;\n    flex: 1;\n    overflow: hidden;\n}\n\n/* Sidebar */\n.sidebar {\n    width: var(--sidebar-width);\n    background: var(--bg-secondary);\n    border-right: 1px solid var(--border);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.sidebar-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    border-bottom: 1px solid var(--border);\n}\n\n.sidebar-header h2 {\n    font-size: 13px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-secondary);\n}\n\n/* Document List */\n.document-list {\n    flex: 1;\n    overflow-y: auto;\n    padding: 8px;\n}\n\n.document-item {\n    padding: 12px;\n    margin-bottom: 4px;\n    background: transparent;\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: background var(--transition);\n}\n\n.document-item:hover {\n    background: var(--bg-tertiary);\n}\n\n.document-item.active {\n    background: var(--accent);\n}\n\n.document-item.active .document-title {\n    color: white;\n}\n\n.document-item.active .document-meta {\n    color: rgba(255, 255, 255, 0.7);\n}\n\n.document-title {\n    font-size: 14px;\n    font-weight: 500;\n    color: var(--text-primary);\n    margin-bottom: 4px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.document-meta {\n    font-size: 12px;\n    color: var(--text-muted);\n}\n\n.document-list-empty {\n    padding: 24px 16px;\n    text-align: center;\n    color: var(--text-muted);\n}\n\n/* Editor Panel */\n.editor-panel {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "83", "text": "/* Editor Panel */\n.editor-panel {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.editor-placeholder {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 16px;\n    color: var(--text-muted);\n}\n\n.editor-container {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.editor-container.hidden {\n    display: none;\n}\n\n.editor-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background: var(--bg-secondary);\n    border-bottom: 1px solid var(--border);\n}\n\n.editor-title {\n    font-size: 14px;\n    font-weight: 500;\n    color: var(--text-secondary);\n}\n\n.save-status {\n    font-size: 12px;\n    color: var(--text-muted);\n}\n\n.save-status.saving {\n    color: var(--warning);\n}\n\n.save-status.saved {\n    color: var(--success);\n}\n\n.save-status.error {\n    color: var(--error);\n}\n\n/* CodeMirror Overrides */\n.CodeMirror {\n    flex: 1;\n    height: auto !important;\n    font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;\n    font-size: 14px;\n    line-height: 1.6;\n    background: var(--bg-primary);\n}\n\n.CodeMirror-gutters {\n    background: var(--bg-primary);\n    border-right: 1px solid var(--border);\n}\n\n.CodeMirror-linenumber {\n    color: var(--text-muted);\n}\n\n/* Scrollbar */\n::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--border);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--text-muted);\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "84", "text": "::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--border);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--text-muted);\n}\n\n/* Modal */\n.modal {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 1000;\n}\n\n.modal.open {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modal-backdrop {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.6);\n    backdrop-filter: blur(4px);\n}\n\n.modal-content {\n    position: relative;\n    width: 90%;\n    max-width: 600px;\n    max-height: 80vh;\n    background: var(--bg-secondary);\n    border-radius: 12px;\n    border: 1px solid var(--border);\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid var(--border);\n}\n\n.modal-header h2 {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.modal-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.modal-body {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px 20px;\n}\n\n.modal-close {\n    color: var(--text-secondary);\n}\n\n.modal-close:hover {\n    color: var(--text-primary);\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "85", "text": ".modal-close {\n    color: var(--text-secondary);\n}\n\n.modal-close:hover {\n    color: var(--text-primary);\n}\n\n/* Checkbox */\n.checkbox-label {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    font-size: 13px;\n    color: var(--text-secondary);\n    cursor: pointer;\n}\n\n.checkbox-label input[type=\"checkbox\"] {\n    width: 14px;\n    height: 14px;\n    accent-color: var(--accent);\n}\n\n/* TODO Styles */\n.todo-stats {\n    display: flex;\n    gap: 24px;\n    margin-bottom: 20px;\n    padding-bottom: 16px;\n    border-bottom: 1px solid var(--border);\n}\n\n.stat-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.stat-value {\n    font-size: 24px;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.stat-label {\n    font-size: 12px;\n    color: var(--text-muted);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.todo-loading,\n.todo-empty {\n    text-align: center;\n    padding: 32px;\n    color: var(--text-muted);\n}\n\n.todo-empty .text-muted {\n    font-size: 13px;\n    margin-top: 8px;\n}\n\n.todo-group {\n    margin-bottom: 16px;\n}\n\n.todo-group-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 0;\n    margin-bottom: 8px;\n    border-bottom: 1px solid var(--border);\n}\n\n.todo-group-title {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--text-secondary);\n}\n\n.todo-group-count {\n    font-size: 12px;\n    padding: 2px 8px;\n    background: var(--bg-tertiary);\n    border-radius: 10px;\n    color: var(--text-muted);\n}\n\n.todo-group-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "86", "text": ".todo-group-items {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.todo-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 10px 12px;\n    background: var(--bg-tertiary);\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: background var(--transition);\n}\n\n.todo-item:hover {\n    background: var(--border);\n}\n\n.todo-item.done {\n    opacity: 0.6;\n}\n\n.todo-item.done .todo-text {\n    text-decoration: line-through;\n}\n\n.todo-checkbox {\n    width: 18px;\n    height: 18px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: 2px solid var(--text-muted);\n    border-radius: 4px;\n    font-size: 12px;\n    color: var(--success);\n    flex-shrink: 0;\n}\n\n.todo-item.done .todo-checkbox {\n    border-color: var(--success);\n    background: var(--success);\n    color: white;\n}\n\n.todo-text {\n    flex: 1;\n    font-size: 14px;\n    color: var(--text-primary);\n    line-height: 1.4;\n}\n\n.todo-line {\n    font-size: 11px;\n    color: var(--text-muted);\n    padding: 2px 6px;\n    background: var(--bg-secondary);\n    border-radius: 4px;\n}\n\n/* Search Results */\n.search-results-panel {\n    display: none;\n    position: fixed;\n    top: var(--topbar-height);\n    left: 50%;\n    transform: translateX(-50%);\n    width: 90%;\n    max-width: 500px;\n    max-height: 400px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: var(--radius);\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);\n    z-index: 500;\n    flex-direction: column;\n    overflow: hidden;\n    margin-top: 8px;\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "87", "text": ".search-results-panel.open {\n    display: flex;\n}\n\n.search-results-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 14px;\n    border-bottom: 1px solid var(--border);\n}\n\n.search-results-title {\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-secondary);\n}\n\n.search-close {\n    color: var(--text-muted);\n}\n\n.search-results-body {\n    flex: 1;\n    overflow-y: auto;\n}\n\n.search-results-list {\n    padding: 8px;\n}\n\n.search-loading,\n.search-empty,\n.search-error {\n    padding: 24px;\n    text-align: center;\n    color: var(--text-muted);\n}\n\n.search-result-item {\n    padding: 12px;\n    margin-bottom: 4px;\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: background var(--transition);\n}\n\n.search-result-item:hover,\n.search-result-item.selected {\n    background: var(--bg-tertiary);\n}\n\n.search-result-item.selected {\n    outline: 1px solid var(--accent);\n}\n\n.search-result-title {\n    font-size: 14px;\n    font-weight: 500;\n    color: var(--text-primary);\n    margin-bottom: 4px;\n}\n\n.search-result-snippet {\n    font-size: 13px;\n    color: var(--text-secondary);\n    line-height: 1.4;\n    margin-bottom: 6px;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n}\n\n.search-result-meta {\n    display: flex;\n    gap: 8px;\n}\n\n.search-result-score {\n    font-size: 11px;\n    color: var(--accent);\n    padding: 2px 6px;\n    background: rgba(99, 102, 241, 0.15);\n    border-radius: 4px;\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "88", "text": "/* Consolidation Modal */\n.consolidation-modal-content {\n    max-width: 1000px;\n    width: 95%;\n    max-height: 85vh;\n}\n\n.consolidation-body {\n    min-height: 300px;\n    display: flex;\n    flex-direction: column;\n}\n\n.consolidation-loading {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 16px;\n    color: var(--text-secondary);\n}\n\n.spinner {\n    width: 32px;\n    height: 32px;\n    border: 3px solid var(--border);\n    border-top-color: var(--accent);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n.consolidation-error {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 16px;\n    padding: 24px;\n}\n\n.consolidation-error .error-message {\n    color: var(--error);\n    text-align: center;\n}\n\n.consolidation-diff {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n.diff-container {\n    flex: 1;\n    display: flex;\n    gap: 1px;\n    background: var(--border);\n    overflow: hidden;\n    border-radius: var(--radius);\n}\n\n.diff-pane {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    background: var(--bg-primary);\n    overflow: hidden;\n}\n\n.diff-pane-header {\n    padding: 10px 14px;\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    color: var(--text-secondary);\n    background: var(--bg-secondary);\n    border-bottom: 1px solid var(--border);\n}\n\n.diff-original .diff-pane-header {\n    color: var(--text-muted);\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "89", "text": ".diff-original .diff-pane-header {\n    color: var(--text-muted);\n}\n\n.diff-consolidated .diff-pane-header {\n    color: var(--accent);\n}\n\n.diff-pane-content {\n    flex: 1;\n    overflow-y: auto;\n    font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;\n    font-size: 13px;\n    line-height: 1.5;\n}\n\n.diff-line {\n    display: flex;\n    min-height: 22px;\n}\n\n.diff-line .line-number {\n    width: 40px;\n    padding: 0 8px;\n    text-align: right;\n    color: var(--text-muted);\n    background: var(--bg-secondary);\n    flex-shrink: 0;\n    user-select: none;\n}\n\n.diff-line .line-content {\n    flex: 1;\n    padding: 0 12px;\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n.diff-line.highlight-heading {\n    background: rgba(99, 102, 241, 0.1);\n}\n\n.diff-line.highlight-heading .line-content {\n    color: var(--accent);\n    font-weight: 500;\n}\n\n.diff-line.highlight-todo {\n    background: rgba(245, 158, 11, 0.1);\n}\n\n.diff-line.highlight-todo .line-content {\n    color: var(--warning);\n}\n\n.diff-line.highlight-question {\n    background: rgba(239, 68, 68, 0.1);\n}\n\n.diff-line.highlight-question .line-content {\n    color: var(--error);\n}\n\n.diff-line.highlight-done {\n    background: rgba(34, 197, 94, 0.1);\n}\n\n.diff-line.highlight-done .line-content {\n    color: var(--success);\n}\n\n.modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px 20px;\n    border-top: 1px solid var(--border);\n    background: var(--bg-secondary);\n}\n\n.consolidation-actions {\n    display: flex;\n    gap: 12px;\n}\n\n.reject-btn {\n    color: var(--text-secondary);\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "90", "text": ".consolidation-actions {\n    display: flex;\n    gap: 12px;\n}\n\n.reject-btn {\n    color: var(--text-secondary);\n}\n\n.reject-btn:hover {\n    color: var(--error);\n    border-color: var(--error);\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n    .sidebar {\n        position: absolute;\n        left: 0;\n        top: var(--topbar-height);\n        height: calc(100% - var(--topbar-height));\n        z-index: 100;\n        transform: translateX(-100%);\n        transition: transform var(--transition);\n    }\n\n    .sidebar.open {\n        transform: translateX(0);\n    }\n\n    .top-bar-center {\n        display: none;\n    }\n\n    .modal-content {\n        width: 95%;\n        max-height: 90vh;\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/css/style.css", "file_name": "style.css", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "91", "text": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta name=\"theme-color\" content=\"#1a1a2e\">\n    <title>Braindump</title>\n    <link rel=\"stylesheet\" href=\"/css/style.css\">\n    <!-- CodeMirror -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css\">\n</head>\n<body>\n    <div id=\"app\">\n        <!-- Top Bar -->\n        <header class=\"top-bar\">\n            <div class=\"top-bar-left\">\n                <h1 class=\"logo\">Braindump</h1>\n            </div>\n            <div class=\"top-bar-center\">\n                <input type=\"text\" id=\"search-input\" placeholder=\"Search documents...\" title=\"Semantic search (Cmd+K)\">\n            </div>\n            <div class=\"top-bar-right\">\n                <button id=\"btn-new\" class=\"btn btn-primary\" title=\"New fragment (Cmd+N)\">+ New</button>\n                <button id=\"btn-todos\" class=\"btn\" title=\"View all TODOs\">TODOs</button>\n                <button id=\"btn-consolidate\" class=\"btn\" title=\"Consolidate current document with AI\">Consolidate</button>\n            </div>\n        </header>", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/index.html", "file_name": "index.html", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "92", "text": "<!-- Main Content -->\n        <main class=\"main-content\">\n            <!-- Left Panel: Document List -->\n            <aside class=\"sidebar\">\n                <div class=\"sidebar-header\">\n                    <h2>Recent</h2>\n                    <button id=\"btn-refresh\" class=\"btn-icon\" title=\"Refresh list\">\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                            <path d=\"M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"/>\n                        </svg>\n                    </button>\n                </div>\n                <div id=\"document-list\" class=\"document-list\">\n                    <!-- Documents populated by JS -->\n                </div>\n            </aside>\n\n            <!-- Main Panel: Editor -->\n            <section class=\"editor-panel\">\n                <div id=\"editor-placeholder\" class=\"editor-placeholder\">\n                    <p>Select a document or create a new one</p>\n                    <button id=\"btn-new-placeholder\" class=\"btn btn-primary\">+ New Fragment</button>\n                </div>\n                <div id=\"editor-container\" class=\"editor-container hidden\">\n                    <div class=\"editor-header\">\n                        <span id=\"editor-title\" class=\"editor-title\">Untitled</span>\n                        <span id=\"save-status\" class=\"save-status\">Saved</span>\n                    </div>\n                    <textarea id=\"editor\"></textarea>\n                </div>\n            </section>\n        </main>\n    </div>\n\n    <!-- Scripts -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js\"></script>\n    <script type=\"module\" src=\"/js/app.js\"></script>\n</body>\n</html>", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/index.html", "file_name": "index.html", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "93", "text": "/**\n * Braindump - Main Application\n *\n * Initializes the app and coordinates between modules.\n */\n\nimport { DocumentManager } from './documents.js';\nimport { Editor } from './editor.js';\nimport { TodoModal } from './todos.js';\nimport { SearchManager } from './search.js';\nimport { ConsolidationModal } from './consolidation.js';\n\nclass App {\n    constructor() {\n        this.documents = new DocumentManager();\n        this.editor = null;\n        this.currentDocId = null;\n        this.todoModal = null;\n        this.searchManager = null;\n        this.consolidationModal = null;\n    }\n\n    async init() {\n        // Initialize editor\n        this.editor = new Editor('editor', {\n            onSave: (content) => this.handleSave(content),\n            onTitleChange: (title) => this.handleTitleChange(title),\n        });\n\n        // Initialize TODO modal\n        this.todoModal = new TodoModal({\n            onNavigate: (docId, lineNumber) => this.navigateToLine(docId, lineNumber),\n        });\n\n        // Initialize search\n        this.searchManager = new SearchManager({\n            onSelect: (docId) => this.openDocument(docId),\n        });\n\n        // Initialize consolidation modal\n        this.consolidationModal = new ConsolidationModal({\n            onAccept: (result) => {\n                console.log('Consolidation accepted:', result);\n                this.loadDocuments();\n                if (result.document_id) {\n                    this.openDocument(result.document_id);\n                }\n            },\n            onReject: () => {\n                console.log('Consolidation rejected');\n            },\n        });\n\n        // Bind UI events\n        this.bindEvents();\n\n        // Load documents\n        await this.loadDocuments();\n\n        // Keyboard shortcuts\n        this.bindKeyboardShortcuts();\n\n        console.log('Braindump initialized');\n    }\n\n    bindEvents() {\n        // New document buttons\n        document.getElementById('btn-new').addEventListener('click', () => this.createNewDocument());\n        document.getElementById('btn-new-placeholder').addEventListener('click', () => this.createNewDocument());\n\n        // Refresh button\n        document.getElementById('btn-refresh').addEventListener('click', () => this.loadDocuments());\n\n        // TODOs button\n        document.getElementById('btn-todos').addEventListener('click', () => this.todoModal.show());", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/app.js", "file_name": "app.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "94", "text": "// Refresh button\n        document.getElementById('btn-refresh').addEventListener('click', () => this.loadDocuments());\n\n        // TODOs button\n        document.getElementById('btn-todos').addEventListener('click', () => this.todoModal.show());\n\n        // Consolidate button\n        document.getElementById('btn-consolidate').addEventListener('click', () => this.handleConsolidate());\n\n        // Document list clicks (event delegation)\n        document.getElementById('document-list').addEventListener('click', (e) => {\n            const item = e.target.closest('.document-item');\n            if (item) {\n                this.openDocument(item.dataset.id);\n            }\n        });\n    }\n\n    bindKeyboardShortcuts() {\n        document.addEventListener('keydown', (e) => {\n            // Cmd/Ctrl + N: New document\n            if ((e.metaKey || e.ctrlKey) && e.key === 'n') {\n                e.preventDefault();\n                this.createNewDocument();\n            }\n\n            // Cmd/Ctrl + S: Force save (though auto-save handles this)\n            if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n                e.preventDefault();\n                if (this.currentDocId) {\n                    this.editor.forceSave();\n                }\n            }\n\n            // Cmd/Ctrl + K: Focus search\n            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n                e.preventDefault();\n                document.getElementById('search-input').focus();\n            }\n        });\n    }\n\n    async loadDocuments() {\n        const docs = await this.documents.list();\n        this.renderDocumentList(docs);\n    }\n\n    renderDocumentList(docs) {\n        const list = document.getElementById('document-list');\n\n        if (docs.length === 0) {\n            list.innerHTML = `\n                <div class=\"document-list-empty\">\n                    <p>No documents yet</p>\n                    <p>Click \"+ New\" to create one</p>\n                </div>\n            `;\n            return;\n        }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/app.js", "file_name": "app.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "95", "text": "list.innerHTML = docs.map(doc => `\n            <div class=\"document-item ${doc.id === this.currentDocId ? 'active' : ''}\" data-id=\"${doc.id}\">\n                <div class=\"document-title\">${this.escapeHtml(doc.title) || 'Untitled'}</div>\n                <div class=\"document-meta\">${this.formatDate(doc.modified)}</div>\n            </div>\n        `).join('');\n    }\n\n    async createNewDocument() {\n        const doc = await this.documents.create('');\n        await this.loadDocuments();\n        this.openDocument(doc.id);\n    }\n\n    async openDocument(docId, lineNumber = null) {\n        // Save current document first if dirty\n        if (this.currentDocId && this.editor.isDirty()) {\n            await this.editor.forceSave();\n        }\n\n        const doc = await this.documents.get(docId);\n        if (!doc) return;\n\n        this.currentDocId = docId;\n\n        // Update UI\n        document.getElementById('editor-placeholder').classList.add('hidden');\n        document.getElementById('editor-container').classList.remove('hidden');\n        document.getElementById('editor-title').textContent = doc.title || 'Untitled';\n\n        // Load content into editor\n        this.editor.setContent(doc.content);\n\n        // Navigate to specific line if provided\n        if (lineNumber) {\n            this.editor.goToLine(lineNumber);\n        }\n\n        this.editor.focus();\n\n        // Update active state in list\n        document.querySelectorAll('.document-item').forEach(item => {\n            item.classList.toggle('active', item.dataset.id === docId);\n        });\n    }\n\n    async navigateToLine(docId, lineNumber) {\n        await this.openDocument(docId, lineNumber);\n    }\n\n    async handleSave(content) {\n        if (!this.currentDocId) return;\n\n        try {\n            this.setSaveStatus('saving');\n            await this.documents.update(this.currentDocId, content);\n            this.setSaveStatus('saved');\n\n            // Refresh document list to update titles/timestamps\n            await this.loadDocuments();\n        } catch (error) {\n            console.error('Save failed:', error);\n            this.setSaveStatus('error');\n        }\n    }\n\n    handleTitleChange(title) {\n        document.getElementById('editor-title').textContent = title || 'Untitled';\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/app.js", "file_name": "app.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "96", "text": "handleTitleChange(title) {\n        document.getElementById('editor-title').textContent = title || 'Untitled';\n    }\n\n    handleConsolidate() {\n        if (!this.currentDocId) {\n            alert('Please open a document first');\n            return;\n        }\n\n        // Save any pending changes first\n        if (this.editor.isDirty()) {\n            this.editor.forceSave().then(() => {\n                this.consolidationModal.consolidate(this.currentDocId);\n            });\n        } else {\n            this.consolidationModal.consolidate(this.currentDocId);\n        }\n    }\n\n    setSaveStatus(status) {\n        const el = document.getElementById('save-status');\n        el.className = 'save-status ' + status;\n        el.textContent = status === 'saving' ? 'Saving...' :\n                         status === 'saved' ? 'Saved' :\n                         'Save failed';\n    }\n\n    formatDate(timestamp) {\n        const date = new Date(timestamp * 1000);\n        const now = new Date();\n        const diff = now - date;\n\n        // Less than a minute\n        if (diff < 60000) return 'Just now';\n\n        // Less than an hour\n        if (diff < 3600000) {\n            const mins = Math.floor(diff / 60000);\n            return `${mins}m ago`;\n        }\n\n        // Less than a day\n        if (diff < 86400000) {\n            const hours = Math.floor(diff / 3600000);\n            return `${hours}h ago`;\n        }\n\n        // Less than a week\n        if (diff < 604800000) {\n            const days = Math.floor(diff / 86400000);\n            return `${days}d ago`;\n        }\n\n        // Otherwise show date\n        return date.toLocaleDateString();\n    }\n\n    escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n}\n\n// Initialize app when DOM is ready\ndocument.addEventListener('DOMContentLoaded', () => {\n    window.app = new App();\n    window.app.init();\n});", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/app.js", "file_name": "app.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "97", "text": "/**\n * Braindump - Consolidation Module\n *\n * Handles document consolidation and diff viewing.\n */\n\nconst API_BASE = '/api';\n\nexport class ConsolidationAPI {\n    /**\n     * Start consolidation for a document.\n     */\n    async consolidate(documentId) {\n        const response = await fetch(`${API_BASE}/consolidate`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ document_id: documentId }),\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Consolidation failed');\n        }\n\n        return response.json();\n    }\n\n    /**\n     * Start consolidation for multiple documents.\n     */\n    async consolidateMultiple(documentIds) {\n        const response = await fetch(`${API_BASE}/consolidate`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ document_ids: documentIds }),\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Consolidation failed');\n        }\n\n        return response.json();\n    }\n\n    /**\n     * List active consolidation proposals.\n     */\n    async listProposals() {\n        const response = await fetch(`${API_BASE}/consolidate/proposals`);\n        if (!response.ok) throw new Error('Failed to fetch proposals');\n        return response.json();\n    }\n\n    /**\n     * Get a specific proposal.\n     */\n    async getProposal(branchName) {\n        const response = await fetch(`${API_BASE}/consolidate/proposals/${branchName}`);\n        if (!response.ok) throw new Error('Failed to fetch proposal');\n        return response.json();\n    }\n\n    /**\n     * Accept a consolidation proposal.\n     */\n    async acceptProposal(branchName) {\n        const response = await fetch(`${API_BASE}/consolidate/proposals/${branchName}/accept`, {\n            method: 'POST',\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Accept failed');\n        }\n\n        return response.json();\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "98", "text": "if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Accept failed');\n        }\n\n        return response.json();\n    }\n\n    /**\n     * Reject a consolidation proposal.\n     */\n    async rejectProposal(branchName) {\n        const response = await fetch(`${API_BASE}/consolidate/proposals/${branchName}/reject`, {\n            method: 'POST',\n        });\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Reject failed');\n        }\n\n        return response.json();\n    }\n}\n\n\nexport class ConsolidationModal {\n    constructor(options = {}) {\n        this.options = {\n            onAccept: () => {},\n            onReject: () => {},\n            ...options\n        };\n        this.api = new ConsolidationAPI();\n        this.modal = null;\n        this.currentProposal = null;\n        this.createModal();\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "99", "text": "createModal() {\n        this.modal = document.createElement('div');\n        this.modal.className = 'modal consolidation-modal';\n        this.modal.innerHTML = `\n            <div class=\"modal-backdrop\"></div>\n            <div class=\"modal-content consolidation-modal-content\">\n                <div class=\"modal-header\">\n                    <h2>Consolidation Preview</h2>\n                    <div class=\"modal-header-actions\">\n                        <button class=\"btn-icon modal-close\" title=\"Close\">\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                <path d=\"M18 6L6 18M6 6l12 12\"/>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"modal-body consolidation-body\">\n                    <div class=\"consolidation-loading\">\n                        <div class=\"spinner\"></div>\n                        <p>Processing with AI...</p>\n                    </div>\n                    <div class=\"consolidation-error hidden\">\n                        <p class=\"error-message\"></p>\n                        <button class=\"btn btn-primary retry-btn\">Try Again</button>\n                    </div>\n                    <div class=\"consolidation-diff hidden\">\n                        <div class=\"diff-container\">\n                            <div class=\"diff-pane diff-original\">\n                                <div class=\"diff-pane-header\">Original</div>\n                                <div class=\"diff-pane-content\"></div>\n                            </div>\n                            <div class=\"diff-pane diff-consolidated\">\n                                <div class=\"diff-pane-header\">Consolidated</div>\n                                <div class=\"diff-pane-content\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer hidden\">\n                    <div class=\"consolidation-actions\">\n                        <button class=\"btn reject-btn\">Reject</button>\n                        <button class=\"btn btn-primary accept-btn\">Accept Changes</button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        document.body.appendChild(this.modal);", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "100", "text": "document.body.appendChild(this.modal);\n\n        // Bind events\n        this.modal.querySelector('.modal-backdrop').addEventListener('click', () => this.hide());\n        this.modal.querySelector('.modal-close').addEventListener('click', () => this.hide());\n        this.modal.querySelector('.accept-btn').addEventListener('click', () => this.handleAccept());\n        this.modal.querySelector('.reject-btn').addEventListener('click', () => this.handleReject());\n        this.modal.querySelector('.retry-btn').addEventListener('click', () => {\n            if (this.pendingDocId) {\n                this.consolidate(this.pendingDocId);\n            }\n        });\n\n        // Close on Escape\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && this.modal.classList.contains('open')) {\n                this.hide();\n            }\n        });\n    }\n\n    async show() {\n        this.modal.classList.add('open');\n    }\n\n    hide() {\n        this.modal.classList.remove('open');\n        this.currentProposal = null;\n    }\n\n    showLoading() {\n        this.modal.querySelector('.consolidation-loading').classList.remove('hidden');\n        this.modal.querySelector('.consolidation-error').classList.add('hidden');\n        this.modal.querySelector('.consolidation-diff').classList.add('hidden');\n        this.modal.querySelector('.modal-footer').classList.add('hidden');\n    }\n\n    showError(message) {\n        this.modal.querySelector('.consolidation-loading').classList.add('hidden');\n        this.modal.querySelector('.consolidation-error').classList.remove('hidden');\n        this.modal.querySelector('.consolidation-diff').classList.add('hidden');\n        this.modal.querySelector('.modal-footer').classList.add('hidden');\n        this.modal.querySelector('.error-message').textContent = message;\n    }\n\n    showDiff(proposal) {\n        this.modal.querySelector('.consolidation-loading').classList.add('hidden');\n        this.modal.querySelector('.consolidation-error').classList.add('hidden');\n        this.modal.querySelector('.consolidation-diff').classList.remove('hidden');\n        this.modal.querySelector('.modal-footer').classList.remove('hidden');\n\n        // Render original content\n        const originalPane = this.modal.querySelector('.diff-original .diff-pane-content');\n        originalPane.innerHTML = this.renderContent(proposal.diff.original);", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "101", "text": "// Render original content\n        const originalPane = this.modal.querySelector('.diff-original .diff-pane-content');\n        originalPane.innerHTML = this.renderContent(proposal.diff.original);\n\n        // Render consolidated content\n        const consolidatedPane = this.modal.querySelector('.diff-consolidated .diff-pane-content');\n        consolidatedPane.innerHTML = this.renderContent(proposal.diff.consolidated);\n\n        this.currentProposal = proposal;\n    }\n\n    renderContent(content) {\n        // Escape HTML and preserve line breaks\n        const lines = content.split('\\n');\n        return lines.map((line, i) => {\n            const lineNum = i + 1;\n            const escapedLine = this.escapeHtml(line) || '&nbsp;';\n            const highlightClass = this.getLineHighlight(line);\n            return `<div class=\"diff-line ${highlightClass}\"><span class=\"line-number\">${lineNum}</span><span class=\"line-content\">${escapedLine}</span></div>`;\n        }).join('');\n    }\n\n    getLineHighlight(line) {\n        // Highlight special markers\n        if (line.match(/^\\s*#/)) return 'highlight-heading';\n        if (line.match(/\\bTODO\\b|\\bTASK\\b/)) return 'highlight-todo';\n        if (line.match(/\\[QUESTION:/)) return 'highlight-question';\n        if (line.match(/\\bDONE\\b/)) return 'highlight-done';\n        return '';\n    }\n\n    async consolidate(documentId) {\n        this.pendingDocId = documentId;\n        this.show();\n        this.showLoading();\n\n        try {\n            const result = await this.api.consolidate(documentId);\n            this.showDiff(result);\n        } catch (error) {\n            console.error('Consolidation failed:', error);\n            this.showError(error.message || 'Consolidation failed. Please try again.');\n        }\n    }\n\n    async handleAccept() {\n        if (!this.currentProposal) return;\n\n        const acceptBtn = this.modal.querySelector('.accept-btn');\n        acceptBtn.disabled = true;\n        acceptBtn.textContent = 'Applying...';", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "102", "text": "async handleAccept() {\n        if (!this.currentProposal) return;\n\n        const acceptBtn = this.modal.querySelector('.accept-btn');\n        acceptBtn.disabled = true;\n        acceptBtn.textContent = 'Applying...';\n\n        try {\n            const result = await this.api.acceptProposal(this.currentProposal.branch_name);\n            this.hide();\n            this.options.onAccept(result);\n        } catch (error) {\n            console.error('Accept failed:', error);\n            this.showError(error.message || 'Failed to accept changes.');\n        } finally {\n            acceptBtn.disabled = false;\n            acceptBtn.textContent = 'Accept Changes';\n        }\n    }\n\n    async handleReject() {\n        if (!this.currentProposal) return;\n\n        try {\n            await this.api.rejectProposal(this.currentProposal.branch_name);\n            this.hide();\n            this.options.onReject();\n        } catch (error) {\n            console.error('Reject failed:', error);\n        }\n    }\n\n    escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/consolidation.js", "file_name": "consolidation.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "103", "text": "/**\n * Braindump - Documents Module\n *\n * Handles API communication for document CRUD operations.\n */\n\nconst API_BASE = '/api';\n\nexport class DocumentManager {\n    constructor() {\n        this.cache = new Map();\n    }\n\n    async list() {\n        try {\n            const response = await fetch(`${API_BASE}/documents`);\n            if (!response.ok) throw new Error('Failed to fetch documents');\n\n            const docs = await response.json();\n\n            // Update cache\n            docs.forEach(doc => this.cache.set(doc.id, doc));\n\n            return docs;\n        } catch (error) {\n            console.error('Error listing documents:', error);\n            return [];\n        }\n    }\n\n    async get(id) {\n        try {\n            const response = await fetch(`${API_BASE}/documents/${id}`);\n            if (!response.ok) throw new Error('Document not found');\n\n            const doc = await response.json();\n            this.cache.set(id, doc);\n\n            return doc;\n        } catch (error) {\n            console.error('Error fetching document:', error);\n            return null;\n        }\n    }\n\n    async create(content = '') {\n        try {\n            const response = await fetch(`${API_BASE}/documents`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ content }),\n            });\n\n            if (!response.ok) throw new Error('Failed to create document');\n\n            const doc = await response.json();\n            this.cache.set(doc.id, doc);\n\n            return doc;\n        } catch (error) {\n            console.error('Error creating document:', error);\n            throw error;\n        }\n    }\n\n    async update(id, content) {\n        try {\n            const response = await fetch(`${API_BASE}/documents/${id}`, {\n                method: 'PUT',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ content }),\n            });\n\n            if (!response.ok) throw new Error('Failed to update document');\n\n            const doc = await response.json();\n            this.cache.set(id, doc);\n\n            return doc;\n        } catch (error) {\n            console.error('Error updating document:', error);\n            throw error;\n        }\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/documents.js", "file_name": "documents.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "104", "text": "const doc = await response.json();\n            this.cache.set(id, doc);\n\n            return doc;\n        } catch (error) {\n            console.error('Error updating document:', error);\n            throw error;\n        }\n    }\n\n    async delete(id) {\n        try {\n            const response = await fetch(`${API_BASE}/documents/${id}`, {\n                method: 'DELETE',\n            });\n\n            if (!response.ok) throw new Error('Failed to delete document');\n\n            this.cache.delete(id);\n            return true;\n        } catch (error) {\n            console.error('Error deleting document:', error);\n            throw error;\n        }\n    }\n\n    getCached(id) {\n        return this.cache.get(id);\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/documents.js", "file_name": "documents.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "105", "text": "/**\n * Braindump - Editor Module\n *\n * Manages the CodeMirror editor with auto-save functionality.\n */\n\nexport class Editor {\n    constructor(elementId, options = {}) {\n        this.textarea = document.getElementById(elementId);\n        this.options = {\n            autosaveDelay: 500,\n            onSave: () => {},\n            onTitleChange: () => {},\n            ...options\n        };\n\n        this.cm = null;\n        this.saveTimeout = null;\n        this.dirty = false;\n        this.lastSavedContent = '';\n\n        this.init();\n    }\n\n    init() {\n        // Initialize CodeMirror\n        this.cm = CodeMirror.fromTextArea(this.textarea, {\n            mode: 'markdown',\n            theme: 'dracula',\n            lineNumbers: true,\n            lineWrapping: true,\n            autofocus: false,\n            tabSize: 2,\n            indentWithTabs: false,\n            extraKeys: {\n                'Tab': (cm) => cm.execCommand('indentMore'),\n                'Shift-Tab': (cm) => cm.execCommand('indentLess'),\n            }\n        });\n\n        // Listen for changes\n        this.cm.on('change', () => this.handleChange());\n    }\n\n    handleChange() {\n        const content = this.cm.getValue();\n\n        // Check if actually dirty\n        if (content === this.lastSavedContent) {\n            this.dirty = false;\n            return;\n        }\n\n        this.dirty = true;\n\n        // Extract title from first line\n        const firstLine = content.split('\\n')[0];\n        const title = firstLine.replace(/^#+\\s*/, '').trim();\n        this.options.onTitleChange(title);\n\n        // Debounced auto-save\n        if (this.saveTimeout) {\n            clearTimeout(this.saveTimeout);\n        }\n\n        this.saveTimeout = setTimeout(() => {\n            this.save();\n        }, this.options.autosaveDelay);\n    }\n\n    async save() {\n        if (!this.dirty) return;\n\n        const content = this.cm.getValue();\n        await this.options.onSave(content);\n\n        this.lastSavedContent = content;\n        this.dirty = false;\n    }\n\n    async forceSave() {\n        if (this.saveTimeout) {\n            clearTimeout(this.saveTimeout);\n        }\n        await this.save();\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/editor.js", "file_name": "editor.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "106", "text": "this.lastSavedContent = content;\n        this.dirty = false;\n    }\n\n    async forceSave() {\n        if (this.saveTimeout) {\n            clearTimeout(this.saveTimeout);\n        }\n        await this.save();\n    }\n\n    setContent(content) {\n        this.cm.setValue(content);\n        this.lastSavedContent = content;\n        this.dirty = false;\n\n        // Move cursor to end\n        this.cm.setCursor(this.cm.lineCount(), 0);\n    }\n\n    getContent() {\n        return this.cm.getValue();\n    }\n\n    isDirty() {\n        return this.dirty;\n    }\n\n    focus() {\n        this.cm.focus();\n    }\n\n    goToLine(lineNumber) {\n        // CodeMirror uses 0-based line numbers\n        const line = Math.max(0, lineNumber - 1);\n        this.cm.setCursor(line, 0);\n        this.cm.scrollIntoView({ line, ch: 0 }, 100);\n    }\n\n    clear() {\n        this.setContent('');\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/editor.js", "file_name": "editor.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "107", "text": "/**\n * Braindump - Search Module\n *\n * Handles semantic search functionality.\n */\n\nconst API_BASE = '/api';\n\nexport class SearchManager {\n    constructor(options = {}) {\n        this.options = {\n            onSelect: () => {},\n            debounceMs: 300,\n            ...options\n        };\n\n        this.searchInput = null;\n        this.resultsPanel = null;\n        this.searchTimeout = null;\n        this.isSearching = false;\n\n        this.init();\n    }\n\n    init() {\n        this.searchInput = document.getElementById('search-input');\n        this.createResultsPanel();\n        this.bindEvents();\n    }\n\n    createResultsPanel() {\n        this.resultsPanel = document.createElement('div');\n        this.resultsPanel.className = 'search-results-panel';\n        this.resultsPanel.innerHTML = `\n            <div class=\"search-results-header\">\n                <span class=\"search-results-title\">Search Results</span>\n                <button class=\"btn-icon search-close\" title=\"Close\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path d=\"M18 6L6 18M6 6l12 12\"/>\n                    </svg>\n                </button>\n            </div>\n            <div class=\"search-results-body\">\n                <div class=\"search-results-list\"></div>\n            </div>\n        `;\n        document.body.appendChild(this.resultsPanel);\n\n        // Close button\n        this.resultsPanel.querySelector('.search-close').addEventListener('click', () => {\n            this.hideResults();\n        });\n\n        // Result clicks\n        this.resultsPanel.querySelector('.search-results-list').addEventListener('click', (e) => {\n            const item = e.target.closest('.search-result-item');\n            if (item) {\n                this.hideResults();\n                this.searchInput.value = '';\n                this.options.onSelect(item.dataset.id);\n            }\n        });\n    }\n\n    bindEvents() {\n        // Search input\n        this.searchInput.addEventListener('input', (e) => {\n            const query = e.target.value.trim();\n\n            if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            if (!query) {\n                this.hideResults();\n                return;\n            }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/search.js", "file_name": "search.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "108", "text": "if (this.searchTimeout) {\n                clearTimeout(this.searchTimeout);\n            }\n\n            if (!query) {\n                this.hideResults();\n                return;\n            }\n\n            this.searchTimeout = setTimeout(() => {\n                this.performSearch(query);\n            }, this.options.debounceMs);\n        });\n\n        // Focus/blur\n        this.searchInput.addEventListener('focus', () => {\n            if (this.searchInput.value.trim()) {\n                this.showResults();\n            }\n        });\n\n        // Close on click outside\n        document.addEventListener('click', (e) => {\n            if (!this.resultsPanel.contains(e.target) &&\n                !this.searchInput.contains(e.target)) {\n                this.hideResults();\n            }\n        });\n\n        // Close on Escape\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                this.hideResults();\n                this.searchInput.blur();\n            }\n        });\n\n        // Keyboard navigation\n        this.searchInput.addEventListener('keydown', (e) => {\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                e.preventDefault();\n                this.navigateResults(e.key === 'ArrowDown' ? 1 : -1);\n            } else if (e.key === 'Enter') {\n                const selected = this.resultsPanel.querySelector('.search-result-item.selected');\n                if (selected) {\n                    e.preventDefault();\n                    this.hideResults();\n                    this.searchInput.value = '';\n                    this.options.onSelect(selected.dataset.id);\n                }\n            }\n        });\n    }\n\n    async performSearch(query) {\n        if (this.isSearching) return;\n\n        this.isSearching = true;\n        this.showLoading();\n\n        try {\n            const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}&limit=10`);\n\n            if (!response.ok) {\n                throw new Error('Search failed');\n            }\n\n            const results = await response.json();\n            this.renderResults(results, query);\n        } catch (error) {\n            console.error('Search error:', error);\n            this.renderError();\n        } finally {\n            this.isSearching = false;\n        }\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/search.js", "file_name": "search.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "109", "text": "showLoading() {\n        const list = this.resultsPanel.querySelector('.search-results-list');\n        list.innerHTML = `\n            <div class=\"search-loading\">\n                <span>Searching...</span>\n            </div>\n        `;\n        this.showResults();\n    }\n\n    renderResults(results, query) {\n        const list = this.resultsPanel.querySelector('.search-results-list');\n\n        if (results.length === 0) {\n            list.innerHTML = `\n                <div class=\"search-empty\">\n                    <p>No results for \"${this.escapeHtml(query)}\"</p>\n                </div>\n            `;\n            return;\n        }\n\n        list.innerHTML = results.map((result, index) => `\n            <div class=\"search-result-item ${index === 0 ? 'selected' : ''}\" data-id=\"${result.id}\">\n                <div class=\"search-result-title\">${this.escapeHtml(result.title)}</div>\n                ${result.snippet ? `<div class=\"search-result-snippet\">${this.escapeHtml(result.snippet)}</div>` : ''}\n                <div class=\"search-result-meta\">\n                    ${result.score ? `<span class=\"search-result-score\">${Math.round(result.score * 100)}% match</span>` : ''}\n                </div>\n            </div>\n        `).join('');\n    }\n\n    renderError() {\n        const list = this.resultsPanel.querySelector('.search-results-list');\n        list.innerHTML = `\n            <div class=\"search-error\">\n                <p>Search failed. Please try again.</p>\n            </div>\n        `;\n    }\n\n    navigateResults(direction) {\n        const items = this.resultsPanel.querySelectorAll('.search-result-item');\n        if (items.length === 0) return;\n\n        const current = this.resultsPanel.querySelector('.search-result-item.selected');\n        let nextIndex = 0;\n\n        if (current) {\n            current.classList.remove('selected');\n            const currentIndex = Array.from(items).indexOf(current);\n            nextIndex = currentIndex + direction;\n            if (nextIndex < 0) nextIndex = items.length - 1;\n            if (nextIndex >= items.length) nextIndex = 0;\n        }\n\n        items[nextIndex].classList.add('selected');\n        items[nextIndex].scrollIntoView({ block: 'nearest' });\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/search.js", "file_name": "search.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "110", "text": "items[nextIndex].classList.add('selected');\n        items[nextIndex].scrollIntoView({ block: 'nearest' });\n    }\n\n    showResults() {\n        this.resultsPanel.classList.add('open');\n    }\n\n    hideResults() {\n        this.resultsPanel.classList.remove('open');\n    }\n\n    escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/search.js", "file_name": "search.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "111", "text": "/**\n * Braindump - TODOs Module\n *\n * Manages the Master TODO list view and TODO API interactions.\n */\n\nconst API_BASE = '/api';\n\nexport class TodoManager {\n    constructor() {\n        this.todos = [];\n        this.stats = null;\n    }\n\n    async fetchTodos(includeDone = false) {\n        try {\n            const url = `${API_BASE}/todos${includeDone ? '?include_done=true' : ''}`;\n            const response = await fetch(url);\n            if (!response.ok) throw new Error('Failed to fetch TODOs');\n\n            this.todos = await response.json();\n            return this.todos;\n        } catch (error) {\n            console.error('Error fetching TODOs:', error);\n            return [];\n        }\n    }\n\n    async fetchStats() {\n        try {\n            const response = await fetch(`${API_BASE}/todos/stats`);\n            if (!response.ok) throw new Error('Failed to fetch stats');\n\n            this.stats = await response.json();\n            return this.stats;\n        } catch (error) {\n            console.error('Error fetching stats:', error);\n            return null;\n        }\n    }\n\n    groupByDocument() {\n        const grouped = {};\n        for (const todo of this.todos) {\n            const docId = todo.document_id;\n            if (!grouped[docId]) {\n                grouped[docId] = {\n                    document_id: docId,\n                    document_title: todo.document_title,\n                    filename: todo.filename,\n                    todos: []\n                };\n            }\n            grouped[docId].todos.push(todo);\n        }\n        return Object.values(grouped);\n    }\n}\n\nexport class TodoModal {\n    constructor(options = {}) {\n        this.options = {\n            onNavigate: () => {},\n            ...options\n        };\n        this.manager = new TodoManager();\n        this.modal = null;\n        this.includeDone = false;\n\n        this.createModal();\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/todos.js", "file_name": "todos.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "112", "text": "this.createModal();\n    }\n\n    createModal() {\n        // Create modal element\n        this.modal = document.createElement('div');\n        this.modal.className = 'modal todo-modal';\n        this.modal.innerHTML = `\n            <div class=\"modal-backdrop\"></div>\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h2>Master TODO List</h2>\n                    <div class=\"modal-header-actions\">\n                        <label class=\"checkbox-label\">\n                            <input type=\"checkbox\" id=\"todo-include-done\">\n                            Show completed\n                        </label>\n                        <button class=\"btn-icon modal-close\" title=\"Close\">\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                                <path d=\"M18 6L6 18M6 6l12 12\"/>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"todo-stats\"></div>\n                    <div class=\"todo-list\"></div>\n                </div>\n            </div>\n        `;\n\n        document.body.appendChild(this.modal);\n\n        // Bind events\n        this.modal.querySelector('.modal-backdrop').addEventListener('click', () => this.hide());\n        this.modal.querySelector('.modal-close').addEventListener('click', () => this.hide());\n        this.modal.querySelector('#todo-include-done').addEventListener('change', (e) => {\n            this.includeDone = e.target.checked;\n            this.refresh();\n        });\n\n        // Close on Escape\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && this.modal.classList.contains('open')) {\n                this.hide();\n            }\n        });\n\n        // Event delegation for todo items\n        this.modal.querySelector('.todo-list').addEventListener('click', (e) => {\n            const item = e.target.closest('.todo-item');\n            if (item) {\n                const docId = item.dataset.docId;\n                const lineNumber = parseInt(item.dataset.line, 10);\n                this.hide();\n                this.options.onNavigate(docId, lineNumber);\n            }\n        });\n    }", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/todos.js", "file_name": "todos.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "113", "text": "async show() {\n        this.modal.classList.add('open');\n        await this.refresh();\n    }\n\n    hide() {\n        this.modal.classList.remove('open');\n    }\n\n    async refresh() {\n        const statsEl = this.modal.querySelector('.todo-stats');\n        const listEl = this.modal.querySelector('.todo-list');\n\n        // Show loading\n        listEl.innerHTML = '<div class=\"todo-loading\">Loading...</div>';\n\n        // Fetch data\n        const [todos, stats] = await Promise.all([\n            this.manager.fetchTodos(this.includeDone),\n            this.manager.fetchStats()\n        ]);\n\n        // Render stats\n        if (stats) {\n            statsEl.innerHTML = `\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\">${stats.open_todos}</span>\n                    <span class=\"stat-label\">Open</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\">${stats.completed_todos}</span>\n                    <span class=\"stat-label\">Done</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\">${stats.documents}</span>\n                    <span class=\"stat-label\">Documents</span>\n                </div>\n            `;\n        }\n\n        // Render todos\n        if (todos.length === 0) {\n            listEl.innerHTML = `\n                <div class=\"todo-empty\">\n                    <p>No TODOs found</p>\n                    <p class=\"text-muted\">Add TODO or TASK markers in your documents</p>\n                </div>\n            `;\n            return;\n        }\n\n        // Group by document\n        const grouped = this.manager.groupByDocument();", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/todos.js", "file_name": "todos.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
{"id": "114", "text": "// Group by document\n        const grouped = this.manager.groupByDocument();\n\n        listEl.innerHTML = grouped.map(group => `\n            <div class=\"todo-group\">\n                <div class=\"todo-group-header\">\n                    <span class=\"todo-group-title\">${this.escapeHtml(group.document_title)}</span>\n                    <span class=\"todo-group-count\">${group.todos.length}</span>\n                </div>\n                <div class=\"todo-group-items\">\n                    ${group.todos.map(todo => `\n                        <div class=\"todo-item ${todo.is_done ? 'done' : ''}\"\n                             data-doc-id=\"${todo.document_id}\"\n                             data-line=\"${todo.line_number}\">\n                            <span class=\"todo-checkbox\">${todo.is_done ? '&#10003;' : ''}</span>\n                            <span class=\"todo-text\">${this.escapeHtml(todo.text)}</span>\n                            <span class=\"todo-line\">L${todo.line_number}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n        `).join('');\n    }\n\n    escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n}", "metadata": {"file_path": "/Users/andocmdo/tools/braindump/web/js/todos.js", "file_name": "todos.js", "creation_date": "2026-01-01", "last_modified_date": "2026-01-01"}}
